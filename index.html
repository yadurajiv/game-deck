<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GameDeck - Ideation Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'Crimson Text', serif; }
        
        /* Card Animations */
        .card-container { perspective: 1000px; }
        .card-enter { animation: cardEnter 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .card-discard-left { animation: discardLeft 0.3s ease-in forwards; }
        .card-keep-right { animation: keepRight 0.3s ease-in forwards; }
        .card-burn { animation: burnCard 0.4s ease-in forwards; }
        .card-reshuffle-enter { animation: reshuffleEnter 0.5s ease-out forwards; }

        @keyframes cardEnter { from { opacity: 0; transform: translateY(40px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        @keyframes discardLeft { to { opacity: 0; transform: translateX(-120%) rotate(-20deg); } }
        @keyframes keepRight { to { opacity: 0; transform: translateX(120%) rotate(20deg); } }
        @keyframes burnCard { 0% { transform: scale(1); filter: grayscale(0%); } 50% { transform: scale(0.9); filter: grayscale(100%) brightness(0.5); } 100% { transform: scale(0) translateY(50px); opacity: 0; } }
        @keyframes reshuffleEnter { 0% { transform: translateY(-50px) scale(0.9); opacity: 0; } 50% { transform: translateY(10px) scale(1.02); opacity: 1; } 100% { transform: translateY(0) scale(1); opacity: 1; } }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-100 text-slate-900 h-[100dvh] flex flex-col md:flex-row overflow-hidden">

    <!-- Sidebar -->
    <div class="bg-slate-900 text-slate-300 w-full md:w-64 flex-shrink-0 flex flex-col border-b md:border-r border-slate-700 z-50 relative">
        <div class="p-4 flex justify-between items-center h-16 bg-slate-900 z-50 relative">
            <div class="flex items-center space-x-2">
                <i data-lucide="layers" class="text-indigo-400"></i>
                <h1 id="app-title" class="font-bold text-white tracking-wide">GameDeck</h1>
            </div>
            <div class="flex items-center gap-3">
                <span id="app-version" class="text-xs bg-indigo-900 text-indigo-300 px-2 py-0.5 rounded-full">v4.0.1</span>
                <button onclick="app.toggleMobileMenu()" class="md:hidden text-slate-400 hover:text-white transition-colors p-1">
                    <i data-lucide="menu" id="menu-icon" class="w-6 h-6"></i>
                </button>
            </div>
        </div>

        <div id="sidebar-content" class="hidden md:flex flex-col flex-1 bg-slate-900/95 backdrop-blur-md md:backdrop-blur-none md:bg-transparent absolute md:relative top-16 md:top-0 left-0 w-full md:w-auto h-[calc(100dvh-4rem)] md:h-auto z-40 md:z-auto border-b md:border-0 border-slate-700 md:shadow-none overflow-y-auto md:overflow-visible transition-all">
            <nav class="flex flex-col p-2 space-y-1">
                <button onclick="app.setView('draw')" id="nav-draw" class="flex items-center px-3 py-3 md:py-2 rounded-lg text-sm font-medium transition-colors hover:bg-slate-800 w-full text-left">
                    <i data-lucide="sparkles" class="mr-3 md:mr-2 w-5 h-5 md:w-4 md:h-4"></i> Draw
                </button>
                <button onclick="app.setView('saved')" id="nav-saved" class="flex items-center px-3 py-3 md:py-2 rounded-lg text-sm font-medium transition-colors hover:bg-slate-800 w-full text-left">
                    <i data-lucide="save" class="mr-3 md:mr-2 w-5 h-5 md:w-4 md:h-4"></i> Saved Hand 
                    <span id="saved-count" class="ml-auto bg-slate-800 px-2 py-0.5 rounded-full text-xs">0</span>
                </button>
                <button onclick="app.setView('gallery')" id="nav-gallery" class="flex items-center px-3 py-3 md:py-2 rounded-lg text-sm font-medium transition-colors hover:bg-slate-800 w-full text-left">
                    <i data-lucide="grid" class="mr-3 md:mr-2 w-5 h-5 md:w-4 md:h-4"></i> Gallery
                </button>
            </nav>

            <!-- Dynamic Deck List Container -->
            <div class="mt-auto p-4 border-t border-slate-800 overflow-y-auto no-scrollbar pb-8 md:pb-4">
                <h3 class="text-xs font-bold uppercase text-slate-500 mb-3 tracking-wider">Active Decks</h3>
                <div id="deck-toggle-list" class="space-y-2">
                    <!-- Decks injected via JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 relative overflow-y-auto bg-slate-100 p-2 md:p-8" id="main-content">
        <!-- Views injected here -->
    </main>

    <!-- Templates -->
    <template id="tpl-draw">
        <div class="min-h-full flex flex-col items-center justify-center max-w-lg mx-auto w-full py-2 md:py-4">
            <div class="mb-2 md:mb-6 text-center">
                <span id="deck-label" class="text-xs font-bold uppercase tracking-widest text-slate-400">Combined Deck</span>
                <p id="card-counter" class="text-slate-500 text-sm mt-0.5 md:mt-1">Card 1 of 50</p>
            </div>
            <div id="card-wrapper" class="card-container w-72 h-96 relative touch-none select-none shadow-xl rounded-2xl flex-shrink-0 bg-slate-200"></div>
            <p class="md:hidden text-xs text-indigo-400 mt-4 md:mt-6 flex items-center justify-center gap-4 opacity-70">
                <span>â† Discard</span><span>â€¢</span><span>Keep â†’</span>
            </p>
            <div class="flex gap-3 md:gap-4 mt-4 md:mt-8 w-full max-w-xs px-2 md:px-0">
                <button onclick="app.discard()" class="flex-1 flex flex-col items-center justify-center p-3 md:p-4 bg-white border border-slate-200 rounded-xl shadow-sm hover:shadow-md hover:bg-slate-50 transition-all group active:scale-95">
                    <i data-lucide="trash-2" class="text-slate-400 group-hover:text-red-500 mb-1 w-5 h-5"></i>
                    <span class="text-xs font-bold text-slate-500">Discard</span>
                </button>
                <button onclick="app.burn()" class="w-12 flex flex-col items-center justify-center p-3 md:p-4 bg-slate-200 rounded-xl shadow-sm hover:bg-slate-300 transition-all group active:scale-95" title="Burn">
                    <i data-lucide="flame" class="text-slate-500 group-hover:text-orange-500 mb-1 w-5 h-5"></i>
                </button>
                <button onclick="app.keep()" class="flex-1 flex flex-col items-center justify-center p-3 md:p-4 bg-indigo-600 rounded-xl shadow-lg shadow-indigo-200 hover:bg-indigo-500 hover:shadow-indigo-300 transition-all transform hover:-translate-y-1 active:scale-95">
                    <i data-lucide="save" class="text-white mb-1 w-5 h-5"></i>
                    <span class="text-xs font-bold text-white">Keep</span>
                </button>
            </div>
            <button onclick="app.reshuffle(true)" class="mt-4 md:mt-8 flex items-center text-slate-400 hover:text-indigo-600 text-xs font-bold uppercase tracking-widest transition-colors p-2 mb-safe">
                <i data-lucide="refresh-cw" class="mr-2 w-3 h-3"></i> Reshuffle Deck
            </button>
        </div>
    </template>

    <template id="tpl-saved">
        <div class="max-w-5xl mx-auto w-full pt-4 px-2 md:px-0">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-slate-800">Your Hand</h2>
                <button onclick="app.clearSaved()" class="text-red-500 text-sm font-medium hover:text-red-700 flex items-center bg-white px-3 py-1.5 rounded-lg border border-red-100 shadow-sm">
                    <i data-lucide="trash-2" class="mr-1 w-4 h-4"></i> Clear All
                </button>
            </div>
            <div id="saved-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 pb-20"></div>
            <div id="empty-state" class="hidden text-center py-20 border-2 border-dashed border-slate-300 rounded-xl">
                <div class="text-4xl mb-4">ğŸ«¥</div>
                <p class="text-slate-500 font-medium">No cards saved yet.</p>
                <button onclick="app.setView('draw')" class="text-indigo-600 font-bold text-sm mt-2 hover:underline">Go draw some!</button>
            </div>
        </div>
    </template>

    <template id="tpl-gallery">
        <div class="max-w-6xl mx-auto pb-10 w-full pt-4 px-2 md:px-0">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-slate-800">Full Deck Gallery</h2>
                <p class="text-sm text-slate-500 mt-1">Showing all cards from active decks. <span class="text-orange-600 font-medium">Burned cards</span> are dimmed; tap to restore.</p>
            </div>
            <div id="gallery-content"></div>
        </div>
    </template>

    <script>
        // ==========================================
        // CONFIGURATION & CONTENT DATA
        // ==========================================
        
        const APP_CONFIG = {
            title: "GameDeck",
            version: "v4.0.1",
            
            // Define your suits/categories here. 
            // The 'id' keys (hearts, spades, etc) must match the 'suit' property in card data.
            suits: {
                hearts:   { label: 'Hearts',   icon: 'heart',    color: 'red' },
                spades:   { label: 'Spades',   icon: 'spade',    color: 'slate' },
                diamonds: { label: 'Diamonds', icon: 'diamond',  color: 'red' },
                clubs:    { label: 'Clubs',    icon: 'club',     color: 'slate' },
                joker:    { label: 'Joker',    icon: 'sparkles', color: 'slate' }
            },

            // Define your decks here.
            decks: [
                {
                    id: 'deck_1',
                    name: 'Creative Ways',
                    description: 'Innovation & Remixes',
                    themes: { hearts: "Experience", spades: "Mechanics", diamonds: "Dynamics", clubs: "Innovation", joker: "Wildcard" },
                    cards: [
                        { suit: 'hearts', rank: '2', visual: 'ğŸ•¹ï¸', title: 'Combine Games', concept: 'Mix aspects from different games.', example: 'Monopoly GO!, Palworld' },
                        { suit: 'hearts', rank: '3', visual: 'ğŸŒ€', title: 'Mix Elements', concept: 'Blend mechanics for hybrid synergy.', example: 'SSSnaker, Archero' },
                        { suit: 'hearts', rank: '4', visual: 'ğŸŒ', title: 'Simplify', concept: 'Simplify mid-core for casuals.', example: 'Free Fire, Brawl Stars' },
                        { suit: 'hearts', rank: '5', visual: 'âš™ï¸', title: 'Improve Concepts', concept: 'Polish unpolished genres.', example: 'Lethal Company, Phasmophobia' },
                        { suit: 'hearts', rank: '6', visual: 'ğŸ”„', title: 'Adapt Platform', concept: 'Transfer to new platforms.', example: 'Stumble Guys, Among Us VR' },
                        { suit: 'hearts', rank: '7', visual: 'ğŸ¤ª', title: 'Absurdity', concept: 'Combine the unexpected.', example: 'Palworld, Goat Simulator' },
                        { suit: 'hearts', rank: '8', visual: 'ğŸ¥', title: 'Iconic Moments', concept: 'Famous scenes as gameplay.', example: 'SUPERHOT, Uncharted' },
                        { suit: 'hearts', rank: '9', visual: 'ğŸ“º', title: 'Fake Ads', concept: 'Make fake ads real.', example: 'Project Makeover, Hero Wars' },
                        { suit: 'hearts', rank: '10', visual: 'ğŸ°', title: 'History', concept: 'Rich cultural themes.', example: 'Kingdom Come, Assassin\'s Creed' },
                        { suit: 'hearts', rank: 'J', visual: 'â¤ï¸', title: 'Emotions', concept: 'Evoke specific feelings.', example: 'Journey, Spiritfarer' },
                        { suit: 'hearts', rank: 'Q', visual: 'ğŸ§©', title: '4th Wall', concept: 'Meta-narratives.', example: 'Stanley Parable, Inscryption' },
                        { suit: 'hearts', rank: 'K', visual: 'ğŸš€', title: 'New Tech', concept: 'Leverage emerging tech.', example: 'Beat Saber, Pokemon GO' },
                        { suit: 'hearts', rank: 'A', visual: 'ğŸŒŸ', title: 'Fantasies', concept: 'Fulfill childhood dreams.', example: 'Sea of Thieves, Sims 4' },
                        { suit: 'spades', rank: '2', visual: 'ğŸ› ï¸', title: 'Game Mods', concept: 'Mods into standalone.', example: 'Dota 2, Counter-Strike' },
                        { suit: 'spades', rank: '3', visual: 'ğŸŒ', title: 'Real Life', concept: 'Everyday sensations.', example: 'Papers Please, Unpacking' },
                        { suit: 'spades', rank: '4', visual: 'ğŸ”„', title: 'Inversion', concept: 'Flip the norm.', example: 'Choo-Choo Charles, Carrion' },
                        { suit: 'spades', rank: '5', visual: 'ğŸ²', title: 'Tabletop', concept: 'Board games to digital.', example: 'Among Us (Mafia), Baldur\'s Gate 3' },
                        { suit: 'spades', rank: '6', visual: 'ğŸ”„', title: 'Role Reversal', concept: 'Control world, not hero.', example: 'Loop Hero, Dungeon Keeper' },
                        { suit: 'spades', rank: '7', visual: 'â³', title: 'Game Jams', concept: 'Strict constraints.', example: 'Goat Simulator, Superhot' },
                        { suit: 'spades', rank: '8', visual: 'ğŸ”§', title: 'Reverse Engineer', concept: 'Fix genre frustrations.', example: 'Stardew Valley, Cities: Skylines' },
                        { suit: 'spades', rank: '9', visual: 'ğŸ“–', title: 'Proc. Story', concept: 'Generated narrative arcs.', example: 'Wildermyth, Rimworld' },
                        { suit: 'spades', rank: '10', visual: 'ğŸŒ', title: 'Physics Comedy', concept: 'Wobbly physics humor.', example: 'Human: Fall Flat, Gang Beasts' },
                        { suit: 'spades', rank: 'J', visual: 'ğŸµ', title: 'Rhythm Action', concept: 'Rhythm in non-music genres.', example: 'Crypt of NecroDancer, Hi-Fi Rush' },
                        { suit: 'spades', rank: 'Q', visual: 'ğŸ­', title: 'Automation', concept: 'Complex engineering.', example: 'Factorio, Satisfactory' },
                        { suit: 'spades', rank: 'K', visual: 'ğŸ–¼ï¸', title: 'Art Gameplay', concept: 'Visual medium as mechanic.', example: 'Gorogoa, Viewfinder' },
                        { suit: 'spades', rank: 'A', visual: 'ğŸ¦‡', title: 'Audio Nav', concept: 'See with sound.', example: 'Dark Echo, The Vale' },
                        { suit: 'diamonds', rank: '2', visual: 'âš–ï¸', title: 'Asymmetric', concept: 'Teams of different sizes.', example: 'Dead by Daylight, Among Us' },
                        { suit: 'diamonds', rank: '3', visual: 'â³', title: 'Time Control', concept: 'Rewind/Pause time.', example: 'Braid, Superhot' },
                        { suit: 'diamonds', rank: '4', visual: 'ğŸ‘ï¸', title: 'Perspective', concept: 'Optical illusions.', example: 'Superliminal, Monument Valley' },
                        { suit: 'diamonds', rank: '5', visual: 'ğŸ§ ', title: 'Knowledge', concept: 'Player levels up, not char.', example: 'Outer Wilds, Tunic' },
                        { suit: 'diamonds', rank: '6', visual: 'â„ï¸', title: 'Moral Survival', concept: 'Impossible ethical choices.', example: 'Frostpunk, Papers Please' },
                        { suit: 'diamonds', rank: '7', visual: 'ğŸ’€', title: 'High Lethality', concept: 'One-hit kills.', example: 'Hotline Miami, Ghostrunner' },
                        { suit: 'diamonds', rank: '8', visual: 'ğŸ§›', title: 'Reverse Bullet Hell', concept: 'You are the swarm.', example: 'Vampire Survivors, Brotato' },
                        { suit: 'diamonds', rank: '9', visual: 'ğŸ’»', title: 'UI Narrative', concept: 'Game in an OS.', example: 'Hypnospace Outlaw, Orwell' },
                        { suit: 'diamonds', rank: '10', visual: 'ğŸ•°ï¸', title: 'Alt History', concept: 'Change one event.', example: 'Wolfenstein, Fallout' },
                        { suit: 'diamonds', rank: 'J', visual: 'âš¡', title: 'Modern Myth', concept: 'Myths with modern vibes.', example: 'Hades, Percy Jackson' },
                        { suit: 'diamonds', rank: 'Q', visual: 'â˜•', title: 'Cozy', concept: 'Low stakes, high comfort.', example: 'Unpacking, Coffee Talk' },
                        { suit: 'diamonds', rank: 'K', visual: 'ğŸšª', title: 'Liminal Horror', concept: 'Empty, familiar spaces.', example: 'The Exit 8, Poolrooms' },
                        { suit: 'diamonds', rank: 'A', visual: 'âš½', title: 'Sports Hybrid', concept: 'Sport + Absurdity.', example: 'Rocket League, What the Golf?' },
                        { suit: 'clubs', rank: '2', visual: 'ğŸ—£ï¸', title: 'Non-Violent', concept: 'Conflict via dialogue.', example: 'Disco Elysium, Undertale' },
                        { suit: 'clubs', rank: '3', visual: 'ğŸ ', title: 'Env. Narrative', concept: 'Story via objects.', example: 'Edith Finch, Gone Home' },
                        { suit: 'clubs', rank: '4', visual: 'ğŸ§±', title: 'Destruction', concept: 'Breaking is solving.', example: 'Teardown, Red Faction' },
                        { suit: 'clubs', rank: '5', visual: 'ğŸ—ï¸', title: 'Construction', concept: 'Build tools to solve.', example: 'Besiege, TotK' },
                        { suit: 'clubs', rank: '6', visual: 'ğŸ“', title: 'Unfolding Idle', concept: 'Clicker reveals story.', example: 'Universal Paperclips, A Dark Room' },
                        { suit: 'clubs', rank: '7', visual: 'ğŸ”´', title: 'Streamer API', concept: 'Chat affects game.', example: 'Cult of the Lamb, Twitch Plays' },
                        { suit: 'clubs', rank: '8', visual: 'âŒ¨ï¸', title: 'Typing', concept: 'Typing as combat.', example: 'Typing of the Dead, Epistory' },
                        { suit: 'clubs', rank: '9', visual: 'ğŸ¨', title: 'Color', concept: 'Matching colors mechanics.', example: 'Splatoon, Hue' },
                        { suit: 'clubs', rank: '10', visual: 'ğŸŒŒ', title: 'Gravity', concept: 'Change gravity direction.', example: 'Gravity Rush, Super Mario Galaxy' },
                        { suit: 'clubs', rank: 'J', visual: 'ğŸ–¥ï¸', title: 'Prog. Logic', concept: 'Write code to automate.', example: 'Baba Is You, Human Resource Machine' },
                        { suit: 'clubs', rank: 'Q', visual: 'ğŸ“¸', title: 'Photography', concept: 'Camera as weapon.', example: 'Pokemon Snap, Fatal Frame' },
                        { suit: 'clubs', rank: 'K', visual: 'ğŸœ', title: 'Living World', concept: 'World runs itself.', example: 'Dwarf Fortress, Rain World' },
                        { suit: 'clubs', rank: 'A', visual: 'ğŸª¿', title: 'Stealth Comedy', concept: 'Mischief not murder.', example: 'Untitled Goose Game, Octodad' },
                        { suit: 'joker', rank: 'â˜…', visual: 'ğŸï¸', title: 'Nostalgia', concept: 'Draw on beloved past media.', example: 'Cuphead, Shovel Knight' }
                    ]
                },
                {
                    id: 'deck_2',
                    name: 'Adv. Mechanics',
                    description: 'Deep Systems & Logic',
                    themes: { hearts: "Narrative", spades: "Hardcore", diamonds: "Loops", clubs: "Tech", joker: "Wildcard" },
                    cards: [
                        { suit: 'hearts', rank: '2', visual: 'ğŸ¤', title: 'Companion', concept: 'AI partner bond.', example: 'BioShock Infinite, Last of Us' },
                        { suit: 'hearts', rank: '3', visual: 'âš”ï¸', title: 'Rival', concept: 'Recurring antagonist.', example: 'PokÃ©mon, Yakuza' },
                        { suit: 'hearts', rank: '4', visual: 'ğŸ‘¥', title: 'Ensemble', concept: 'Group dynamics.', example: 'Mass Effect, Persona 5' },
                        { suit: 'hearts', rank: '5', visual: 'ğŸ¤¥', title: 'Unreliable', concept: 'Lying narrator.', example: 'Spec Ops, Silent Hill 2' },
                        { suit: 'hearts', rank: '6', visual: 'â™¾ï¸', title: 'Time Loop', concept: 'Relive and learn.', example: '12 Minutes, Outer Wilds' },
                        { suit: 'hearts', rank: '7', visual: 'ğŸ”', title: 'Whodunit', concept: 'Solve a crime.', example: 'Obra Dinn, Disco Elysium' },
                        { suit: 'hearts', rank: '8', visual: 'ğŸ’˜', title: 'Romance', concept: 'Relationships.', example: 'Stardew Valley, Hades' },
                        { suit: 'hearts', rank: '9', visual: 'ğŸ­', title: 'Tragedy', concept: 'Loss and sacrifice.', example: 'Last of Us 2, RDR2' },
                        { suit: 'hearts', rank: '10', visual: 'ğŸ¤¡', title: 'Satire', concept: 'Social commentary.', example: 'Helldivers 2, GTA V' },
                        { suit: 'hearts', rank: 'J', visual: 'ğŸ˜¶', title: 'Silent Hero', concept: 'Player projection.', example: 'Half-Life, Zelda' },
                        { suit: 'hearts', rank: 'Q', visual: 'âš–ï¸', title: 'Moral Gray', concept: 'No good or evil.', example: 'Witcher 3, Fallout New Vegas' },
                        { suit: 'hearts', rank: 'K', visual: 'ğŸŒ²', title: 'Branching', concept: 'Massive variations.', example: 'Detroit, Baldur\'s Gate 3' },
                        { suit: 'hearts', rank: 'A', visual: 'ğŸ¬', title: 'Director AI', concept: 'Dynamic pacing.', example: 'Left 4 Dead 2, Alien Isolation' },
                        { suit: 'spades', rank: '2', visual: 'ğŸƒ', title: 'Deckbuilder', concept: 'Card-based combat.', example: 'Slay the Spire, Balatro' },
                        { suit: 'spades', rank: '3', visual: 'ğŸš', title: 'Extraction', concept: 'High stakes escape.', example: 'Tarkov, Hunt: Showdown' },
                        { suit: 'spades', rank: '4', visual: 'ğŸ›¡ï¸', title: 'Parry', concept: 'Defense is offense.', example: 'Sekiro, Lies of P' },
                        { suit: 'spades', rank: '5', visual: 'ğŸ¥Š', title: 'Combo', concept: 'Chain attacks.', example: 'Devil May Cry, Hi-Fi Rush' },
                        { suit: 'spades', rank: '6', visual: 'ğŸª', title: 'Grapple', concept: 'Vertical mobility.', example: 'Spider-Man, Titanfall 2' },
                        { suit: 'spades', rank: '7', visual: 'ğŸ¦–', title: 'Tamer', concept: 'Capture enemies.', example: 'Palworld, PokÃ©mon' },
                        { suit: 'spades', rank: '8', visual: 'ğŸ‘»', title: 'Possession', concept: 'Control enemies.', example: 'Mario Odyssey, Messiah' },
                        { suit: 'spades', rank: '9', visual: 'ğŸ§Ÿ', title: 'Horde', concept: 'Overwhelming numbers.', example: 'Days Gone, Vampire Survivors' },
                        { suit: 'spades', rank: '10', visual: 'â±ï¸', title: 'Speedrun', concept: 'Optimization.', example: 'Neon White, Mirror\'s Edge' },
                        { suit: 'spades', rank: 'J', visual: 'ğŸ’°', title: 'Heist', concept: 'Plan and execute.', example: 'Payday 2, Monaco' },
                        { suit: 'spades', rank: 'Q', visual: 'ğŸ¤º', title: 'Duel', concept: '1v1 Spacing.', example: 'Nidhogg, For Honor' },
                        { suit: 'spades', rank: 'K', visual: 'ğŸœ', title: 'Size Shift', concept: 'Scale mechanics.', example: 'Grounded, It Takes Two' },
                        { suit: 'spades', rank: 'A', visual: 'ğŸŒ‘', title: 'Shadow', concept: 'Light stealth.', example: 'Thief, Splinter Cell' },
                        { suit: 'diamonds', rank: '2', visual: 'ğŸ”„', title: 'Roguelite', concept: 'Runs with upgrades.', example: 'Hades, Dead Cells' },
                        { suit: 'diamonds', rank: '3', visual: 'ğŸ°', title: 'Gacha', concept: 'Random rewards.', example: 'Genshin Impact, Honkai' },
                        { suit: 'diamonds', rank: '4', visual: 'ğŸ“ˆ', title: 'Prestige', concept: 'Reset for power.', example: 'Cookie Clicker, Idle Miner' },
                        { suit: 'diamonds', rank: '5', visual: 'â›ï¸', title: 'Crafting', concept: 'Gather > Craft.', example: 'Minecraft, Valheim' },
                        { suit: 'diamonds', rank: '6', visual: 'ğŸ’¹', title: 'Player Market', concept: 'Trading economy.', example: 'EVE Online, Warframe' },
                        { suit: 'diamonds', rank: '7', visual: 'ğŸ¦‹', title: 'Collection', concept: 'Fill the museum.', example: 'Animal Crossing, Stardew' },
                        { suit: 'diamonds', rank: '8', visual: 'ğŸŸï¸', title: 'Battle Pass', concept: 'Seasonal tracks.', example: 'Fortnite, Apex Legends' },
                        { suit: 'diamonds', rank: '9', visual: 'âœï¸', title: 'Level Editor', concept: 'UGC Tools.', example: 'Mario Maker, Roblox' },
                        { suit: 'diamonds', rank: '10', visual: 'ğŸ“œ', title: 'Wiki-Bait', concept: 'Obscure lore.', example: 'Tunic, Elden Ring' },
                        { suit: 'diamonds', rank: 'J', visual: 'ğŸ“Š', title: 'Min-Max', concept: 'Deep stats.', example: 'Path of Exile, Diablo IV' },
                        { suit: 'diamonds', rank: 'Q', visual: 'ğŸ“…', title: 'Daily', concept: 'One challenge/day.', example: 'Wordle, Daily Runs' },
                        { suit: 'diamonds', rank: 'K', visual: 'ğŸ“º', title: 'Episodic', concept: 'Released chapters.', example: 'Walking Dead, Deltarune' },
                        { suit: 'diamonds', rank: 'A', visual: 'ğŸ•µï¸', title: 'ARG', concept: 'Reality blending.', example: 'Inscryption, Doki Doki LC' },
                        { suit: 'clubs', rank: '2', visual: 'ğŸ”¥', title: 'Element', concept: 'Chemistry systems.', example: 'BotW, Divinity OS2' },
                        { suit: 'clubs', rank: '3', visual: 'ğŸ‘½', title: 'Stalker AI', concept: 'Hunting enemy.', example: 'Alien: Isolation, Mr. X' },
                        { suit: 'clubs', rank: '4', visual: 'ğŸ•³ï¸', title: 'Deformable', concept: 'Digging terrain.', example: 'Deep Rock Galactic, Minecraft' },
                        { suit: 'clubs', rank: '5', visual: 'ğŸŒŠ', title: 'Fluid', concept: 'Liquid physics.', example: 'Mario Sunshine, Splatoon' },
                        { suit: 'clubs', rank: '6', visual: 'ğŸŒ€', title: 'Portal', concept: 'Non-Euclidean.', example: 'Portal, Antichamber' },
                        { suit: 'clubs', rank: '7', visual: 'ğŸŒ—', title: 'Dual World', concept: 'Dimension swap.', example: 'Titanfall 2, Lords of the Fallen' },
                        { suit: 'clubs', rank: '8', visual: 'ğŸš›', title: 'Vehicle Sim', concept: 'Driving physics.', example: 'SnowRunner, BeamNG' },
                        { suit: 'clubs', rank: '9', visual: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', title: 'Crowd', concept: 'Social stealth.', example: 'Hitman, Assassin\'s Creed' },
                        { suit: 'clubs', rank: '10', visual: 'ğŸš—', title: 'Soft Body', concept: 'Realistic crash.', example: 'BeamNG.drive, Wreckfest' },
                        { suit: 'clubs', rank: 'J', visual: 'ğŸ¤', title: 'Voice', concept: 'Mic input.', example: 'Lethal Company, Phasmophobia' },
                        { suit: 'clubs', rank: 'Q', visual: 'ğŸ“', title: 'GPS', concept: 'Location based.', example: 'Pokemon GO, Monster Hunter Now' },
                        { suit: 'clubs', rank: 'K', visual: 'ğŸ§¬', title: 'Evolution', concept: 'Procedural life.', example: 'Spore, No Man\'s Sky' },
                        { suit: 'clubs', rank: 'A', visual: 'ğŸŒªï¸', title: 'Weather', concept: 'Dynamic storms.', example: 'Sea of Thieves, Mad Max' },
                        { suit: 'joker', rank: 'â˜…', visual: 'ğŸ“€', title: 'Remaster', concept: 'Modernize classic.', example: 'RE4 Remake, Dead Space' }
                    ]
                },
                {
                    id: 'deck_3',
                    name: 'Aesthetics',
                    description: 'Art, Audio & Vibe',
                    themes: { hearts: "Visual Style", spades: "Audio", diamonds: "Camera/View", clubs: "Vibe", joker: "Wildcard" },
                    cards: [
                        { suit: 'hearts', rank: '2', visual: 'ğŸ‘¾', title: 'Pixel Art', concept: 'Retro nostalgia or modern crunch.', example: 'Celeste, Stardew Valley' },
                        { suit: 'hearts', rank: '3', visual: 'ğŸ”³', title: 'Low Poly', concept: 'PS1 era aesthetics.', example: 'Ultrakill, Valheim' },
                        { suit: 'hearts', rank: '4', visual: 'ğŸ–Œï¸', title: 'Cel Shaded', concept: 'Living comic book.', example: 'Borderlands, Hi-Fi Rush' },
                        { suit: 'hearts', rank: '5', visual: 'ğŸŒš', title: 'Noir', concept: 'High contrast black & white.', example: 'Limbo, Trek to Yomi' },
                        { suit: 'hearts', rank: '6', visual: 'ğŸ¨', title: 'Hand-Drawn', concept: 'Traditional animation frames.', example: 'Cuphead, Hollow Knight' },
                        { suit: 'hearts', rank: '7', visual: 'ğŸŒˆ', title: 'Psychedelic', concept: 'Sensory overload colors.', example: 'Hotline Miami, Cruelty Squad' },
                        { suit: 'hearts', rank: '8', visual: 'ğŸ§±', title: 'Voxel', concept: '3D Pixel blocks.', example: 'Minecraft, Teardown' },
                        { suit: 'hearts', rank: '9', visual: 'ğŸ©¸', title: 'Gothic', concept: 'Dark, ornate, imposing.', example: 'Bloodborne, Darkest Dungeon' },
                        { suit: 'hearts', rank: '10', visual: 'â¬œ', title: 'Minimalism', concept: 'Clean lines, flat colors.', example: 'Mini Metro, Superhot' },
                        { suit: 'hearts', rank: 'J', visual: 'ğŸ–¼ï¸', title: 'Watercolor', concept: 'Soft, painted edges.', example: 'Gris, Okami' },
                        { suit: 'hearts', rank: 'Q', visual: 'ğŸ“º', title: 'CRT Filter', concept: 'Analog signal decay.', example: 'Signalis, Balatro' },
                        { suit: 'hearts', rank: 'K', visual: 'ğŸ—¿', title: 'Claymation', concept: 'Stop-motion aesthetic.', example: 'Hylics, Harold Halibut' },
                        { suit: 'hearts', rank: 'A', visual: 'ğŸ“·', title: 'Photoreal', concept: 'Uncanny realism.', example: 'Unrecord, Hellblade II' },
                        { suit: 'spades', rank: '2', visual: 'ğŸ¹', title: 'Dynamic Music', concept: 'Music changes with action.', example: 'Doom Eternal, Metal Hellsinger' },
                        { suit: 'spades', rank: '3', visual: 'ğŸ”‡', title: 'Silence', concept: 'Absence of sound for tension.', example: 'Inside, Dark Souls' },
                        { suit: 'spades', rank: '4', visual: 'ğŸ‘¾', title: 'Chiptune', concept: '8-bit constraints.', example: 'Shovel Knight, Celeste' },
                        { suit: 'spades', rank: '5', visual: 'ğŸ»', title: 'Orchestral', concept: 'Epic cinematic score.', example: 'Elden Ring, Halo' },
                        { suit: 'spades', rank: '6', visual: 'ğŸ§', title: 'Binaural 3D', concept: 'Positional audio focus.', example: 'Hellblade, Hunt: Showdown' },
                        { suit: 'spades', rank: '7', visual: 'ğŸ”Š', title: 'Diegetic', concept: 'Sound comes from in-world.', example: 'Dead Space, Metro Exodus' },
                        { suit: 'spades', rank: '8', visual: 'ğŸ—£ï¸', title: 'Narrator', concept: 'Voiceover reacts to play.', example: 'Bastion, Stanley Parable' },
                        { suit: 'spades', rank: '9', visual: 'ğŸ¥', title: 'Rhythm Sync', concept: 'SFX match the beat.', example: 'Hi-Fi Rush, Rez' },
                        { suit: 'spades', rank: '10', visual: 'ğŸ¤«', title: 'ASMR', concept: 'Satisfying clicks/whispers.', example: 'Unpacking, Dorfromantik' },
                        { suit: 'spades', rank: 'J', visual: 'ğŸ­', title: 'Industrial', concept: 'Grinding metal sounds.', example: 'Factorio, Scorn' },
                        { suit: 'spades', rank: 'Q', visual: 'ğŸ¦—', title: 'Ambient', concept: 'Nature and atmosphere.', example: 'BotW, Skyrim' },
                        { suit: 'spades', rank: 'K', visual: 'ğŸ’¥', title: 'Glitch', concept: 'Audio artifacts/distortion.', example: 'Cyberpunk 2077, Axiom Verge' },
                        { suit: 'spades', rank: 'A', visual: 'ğŸ¸', title: 'Adaptive', concept: 'Instru. layers add up.', example: 'Nier Automata, Hades' },
                        { suit: 'diamonds', rank: '2', visual: 'ğŸ‘€', title: 'First Person', concept: 'Through the eyes.', example: 'Call of Duty, Portal' },
                        { suit: 'diamonds', rank: '3', visual: 'ğŸ“', title: 'Isometric', concept: '3/4 top-down view.', example: 'Hades, Disco Elysium' },
                        { suit: 'diamonds', rank: '4', visual: 'ğŸƒ', title: 'Side Scroller', concept: '2D plane movement.', example: 'Mario, Hollow Knight' },
                        { suit: 'diamonds', rank: '5', visual: 'ğŸš', title: 'Top-Down', concept: 'Bird\'s eye view.', example: 'Hotline Miami, Factorio' },
                        { suit: 'diamonds', rank: '6', visual: 'ğŸ¥', title: 'Fixed Angle', concept: 'Cinematic specific frames.', example: 'Resident Evil 1, God of War 3' },
                        { suit: 'diamonds', rank: '7', visual: 'ğŸ¥½', title: 'VR', concept: 'Headset immersion.', example: 'Half-Life Alyx, Beat Saber' },
                        { suit: 'diamonds', rank: '8', visual: 'ğŸ–¥ï¸', title: 'Second Person', concept: 'Watching a screen in-game.', example: 'FNAF, Observation' },
                        { suit: 'diamonds', rank: '9', visual: 'ğŸ“œ', title: 'Text-Only', concept: 'Imagination driven.', example: 'Zork, AI Dungeon' },
                        { suit: 'diamonds', rank: '10', visual: 'ğŸªŸ', title: 'Split Screen', concept: 'Simultaneous views.', example: 'It Takes Two, Mario Kart' },
                        { suit: 'diamonds', rank: 'J', visual: 'ğŸš«', title: 'UI-less', concept: 'Zero HUD immersion.', example: 'Dead Space, Firewatch' },
                        { suit: 'diamonds', rank: 'Q', visual: 'ğŸ“¹', title: 'CCTV/Bodycam', concept: 'Grainy surveillance lens.', example: 'Observation, Content Warning' },
                        { suit: 'diamonds', rank: 'K', visual: 'ğŸŸ', title: 'Fish-eye', concept: 'Distorted wide angle.', example: 'Cruelty Squad, Skate' },
                        { suit: 'diamonds', rank: 'A', visual: 'ğŸ“±', title: 'Portrait', concept: 'Vertical phone view.', example: 'Clash Royale, Marvel Snap' },
                        { suit: 'clubs', rank: '2', visual: 'â˜•', title: 'Cozy', concept: 'Safe and warm.', example: 'Stardew Valley, Animal Crossing' },
                        { suit: 'clubs', rank: '3', visual: 'ğŸ˜±', title: 'Horror', concept: 'Dread and panic.', example: 'Amnesia, Outlast' },
                        { suit: 'clubs', rank: '4', visual: 'âš¡', title: 'Adrenaline', concept: 'High speed focus.', example: 'Doom, Hotline Miami' },
                        { suit: 'clubs', rank: '5', visual: 'ğŸ§˜', title: 'Zen', concept: 'Flow state relaxation.', example: 'Tetris Effect, Journey' },
                        { suit: 'clubs', rank: '6', visual: 'ğŸ˜¢', title: 'Melancholy', concept: 'Sad but beautiful.', example: 'Gris, Spiritfarer' },
                        { suit: 'clubs', rank: '7', visual: 'ğŸŒ', title: 'Slapstick', concept: 'Goofy physicality.', example: 'Fall Guys, Goat Simulator' },
                        { suit: 'clubs', rank: '8', visual: 'ğŸ°', title: 'Epic', concept: 'Grand scale grandeur.', example: 'Elden Ring, God of War' },
                        { suit: 'clubs', rank: '9', visual: 'ğŸ“¦', title: 'Claustrophobic', concept: 'Tight, oppressive spaces.', example: 'Iron Lung, Metroid' },
                        { suit: 'clubs', rank: '10', visual: 'ğŸï¸', title: 'Nostalgic', concept: 'Yearning for the past.', example: 'Shovel Knight, Stranger Things' },
                        { suit: 'clubs', rank: 'J', visual: 'ğŸ„', title: 'Surreal', concept: 'Dream logic weirdness.', example: 'Superliminal, Control' },
                        { suit: 'clubs', rank: 'Q', visual: 'ğŸª¨', title: 'Gritty', concept: 'Dirty realism.', example: 'Last of Us, Metro' },
                        { suit: 'clubs', rank: 'K', visual: 'ğŸ ', title: 'Whimsical', concept: 'Playful imagination.', example: 'LBP, Psychonauts' },
                        { suit: 'clubs', rank: 'A', visual: 'âœ¨', title: 'Ethereal', concept: 'Otherworldly divine.', example: 'Journey, Sky: Children of Light' },
                        { suit: 'joker', rank: 'â˜…', visual: 'ğŸ¤¡', title: 'Mascot', concept: 'Character-driven brand.', example: 'Mario, Sonic' }
                    ]
                },
                {
                    id: 'deck_4',
                    name: 'World & Setting',
                    description: 'Biomes, Eras & Plots',
                    themes: { hearts: "Biome", spades: "Era/Tech", diamonds: "Faction", clubs: "Plot Hook", joker: "Wildcard" },
                    cards: [
                        { suit: 'hearts', rank: '2', visual: 'â˜ï¸', title: 'Floating Isles', concept: 'Sky world archipelagos.', example: 'BioShock Infinite, Zelda: TotK' },
                        { suit: 'hearts', rank: '3', visual: 'ğŸŒ†', title: 'Cyber City', concept: 'Neon rain metropolis.', example: 'Cyberpunk 2077, Stray' },
                        { suit: 'hearts', rank: '4', visual: 'â˜¢ï¸', title: 'Post-Apoc', concept: 'Ruined civilization.', example: 'Fallout, Horizon Zero Dawn' },
                        { suit: 'hearts', rank: '5', visual: 'ğŸ¦‘', title: 'Deep Sea', concept: 'Underwater pressure.', example: 'Subnautica, Dave the Diver' },
                        { suit: 'hearts', rank: '6', visual: 'ğŸ›°ï¸', title: 'Space Station', concept: 'Technological isolation.', example: 'Prey, Among Us' },
                        { suit: 'hearts', rank: '7', visual: 'ğŸ•³ï¸', title: 'Subterranean', concept: 'Underground networks.', example: 'Hollow Knight, Metro' },
                        { suit: 'hearts', rank: '8', visual: 'ğŸŒŒ', title: 'Infinite Void', concept: 'Empty space/nothingness.', example: 'Outer Wilds, No Man\'s Sky' },
                        { suit: 'hearts', rank: '9', visual: 'ğŸŒ³', title: 'Living Forest', concept: 'Nature is sentient.', example: 'Ori, Darkwood' },
                        { suit: 'hearts', rank: '10', visual: 'ğŸœï¸', title: 'Wasteland', concept: 'Harsh desert survival.', example: 'Mad Max, Dune' },
                        { suit: 'hearts', rank: 'J', visual: 'âš™ï¸', title: 'Clockwork', concept: 'Inside a giant machine.', example: 'Dishonored 2, Machinarium' },
                        { suit: 'hearts', rank: 'Q', visual: 'ğŸ¬', title: 'Candy Land', concept: 'Edible landscape.', example: 'Cuphead, Fall Guys' },
                        { suit: 'hearts', rank: 'K', visual: 'ğŸ’¤', title: 'Dreamscape', concept: 'Logic-defying mind.', example: 'Psychonauts, Omori' },
                        { suit: 'hearts', rank: 'A', visual: 'ğŸ‘¾', title: 'Glitch World', concept: 'Code is breaking down.', example: 'Axiom Verge, Pony Island' },
                        { suit: 'spades', rank: '2', visual: 'ğŸš‚', title: 'Steampunk', concept: 'Brass and steam.', example: 'BioShock, Frostpunk' },
                        { suit: 'spades', rank: '3', visual: 'ğŸ¦´', title: 'Stone Age', concept: 'Primal survival.', example: 'Far Cry Primal, Ancestors' },
                        { suit: 'spades', rank: '4', visual: 'ğŸš€', title: 'Far Future', concept: 'Type III civilization.', example: 'Halo, Mass Effect' },
                        { suit: 'spades', rank: '5', visual: 'ğŸ“¼', title: '1980s', concept: 'Neon retro nostalgia.', example: 'Hotline Miami, GTA Vice City' },
                        { suit: 'spades', rank: '6', visual: 'ğŸ°', title: 'Medieval', concept: 'Swords and castles.', example: 'Witcher, Skyrim' },
                        { suit: 'spades', rank: '7', visual: 'ğŸ¯', title: 'Feudal Japan', concept: 'Samurai and mythology.', example: 'Sekiro, Ghost of Tsushima' },
                        { suit: 'spades', rank: '8', visual: 'ğŸ¤ ', title: 'Wild West', concept: 'Outlaws and frontiers.', example: 'Red Dead, Weird West' },
                        { suit: 'spades', rank: '9', visual: 'ğŸ•µï¸', title: 'Cold War', concept: 'Espionage and tension.', example: 'MGS 3, CoD Black Ops' },
                        { suit: 'spades', rank: '10', visual: 'â˜€ï¸', title: 'Solar Punk', concept: 'Green utopia technology.', example: 'Terra Nil, Overwatch' },
                        { suit: 'spades', rank: 'J', visual: 'â›½', title: 'Dieselpunk', concept: 'Gritty combustion tech.', example: 'Wolfenstein, Iron Harvest' },
                        { suit: 'spades', rank: 'Q', visual: 'ğŸº', title: 'Mythic Age', concept: 'Gods walk the earth.', example: 'God of War, Hades' },
                        { suit: 'spades', rank: 'K', visual: 'ğŸ©', title: 'Victorian', concept: 'Gaslight and cobblestone.', example: 'Bloodborne, Sherlock Holmes' },
                        { suit: 'spades', rank: 'A', visual: 'ğŸ§ ', title: 'Singularity', concept: 'AI transcendence.', example: 'System Shock, SOMA' },
                        { suit: 'diamonds', rank: '2', visual: 'ğŸ§ ', title: 'Hive Mind', concept: 'One shared consciousness.', example: 'The Flood, Tyranids' },
                        { suit: 'diamonds', rank: '3', visual: 'ğŸ¢', title: 'Megacorp', concept: 'Profit over people.', example: 'Arasaka, Shinra' },
                        { suit: 'diamonds', rank: '4', visual: 'ğŸ•¯ï¸', title: 'The Cult', concept: 'Fanatical devotion.', example: 'Far Cry 5, Resident Evil 4' },
                        { suit: 'diamonds', rank: '5', visual: 'âœŠ', title: 'Resistance', concept: 'Underdogs fighting back.', example: 'XCOM, Half-Life 2' },
                        { suit: 'diamonds', rank: '6', visual: 'ğŸ¤–', title: 'AI Gods', concept: 'Machines rule man.', example: 'Matrix, Horizon Zero Dawn' },
                        { suit: 'diamonds', rank: '7', visual: 'ğŸª“', title: 'Barbarians', concept: 'Chaos and strength.', example: 'Mad Max, Warhammer Orks' },
                        { suit: 'diamonds', rank: '8', visual: 'ğŸ“', title: 'Academy', concept: 'Knowledge seekers.', example: 'Hogwarts, Fire Emblem' },
                        { suit: 'diamonds', rank: '9', visual: 'ğŸ“œ', title: 'The Guild', concept: 'Professional network.', example: 'Skyrim Thieves, Witcher' },
                        { suit: 'diamonds', rank: '10', visual: 'ğŸ‘‘', title: 'The Royals', concept: 'Decadent rulers.', example: 'Dishonored, Fable' },
                        { suit: 'diamonds', rank: 'J', visual: 'ğŸ’°', title: 'Bandits', concept: 'Lawless opportunists.', example: 'Borderlands, Fallout Raiders' },
                        { suit: 'diamonds', rank: 'Q', visual: 'ğŸ›ï¸', title: 'Ancients', concept: 'Precursor civilization.', example: 'Forerunners, Zonai' },
                        { suit: 'diamonds', rank: 'K', visual: 'ğŸ§¬', title: 'Mutants', concept: 'Biologically altered.', example: 'X-Men, Fallout Ghouls' },
                        { suit: 'diamonds', rank: 'A', visual: 'ğŸ¦¾', title: 'Cyborgs', concept: 'Man machine hybrids.', example: 'Deus Ex, Cyberpunk' },
                        { suit: 'clubs', rank: '2', visual: 'ğŸ“œ', title: 'Prophecy', concept: 'Chosen one destiny.', example: 'Zelda, Morrowind' },
                        { suit: 'clubs', rank: '3', visual: 'ğŸ’', title: 'The Heist', concept: 'Steal the object.', example: 'GTA V, Payday' },
                        { suit: 'clubs', rank: '4', visual: 'ğŸƒ', title: 'The Escape', concept: 'Get out alive.', example: 'Portal, Hades' },
                        { suit: 'clubs', rank: '5', visual: 'ğŸ˜¡', title: 'Revenge', concept: 'Avenge the fallen.', example: 'God of War, Last of Us 2' },
                        { suit: 'clubs', rank: '6', visual: 'ğŸ•µï¸', title: 'Mystery', concept: 'Find the truth.', example: 'Outer Wilds, Her Story' },
                        { suit: 'clubs', rank: '7', visual: 'ğŸ†', title: 'Tournament', concept: 'Prove you are best.', example: 'Mortal Kombat, Apex Legends' },
                        { suit: 'clubs', rank: '8', visual: 'ğŸš©', title: 'Colonization', concept: 'Tame the wild.', example: 'Factorio, Rimworld' },
                        { suit: 'clubs', rank: '9', visual: 'â›º', title: 'Survival', concept: 'Endure the elements.', example: 'The Long Dark, Don\'t Starve' },
                        { suit: 'clubs', rank: '10', visual: 'âš”ï¸', title: 'The War', concept: 'Turn the tide.', example: 'Call of Duty, Helldivers' },
                        { suit: 'clubs', rank: 'J', visual: 'ğŸ§­', title: 'Discovery', concept: 'Map the unknown.', example: 'No Man\'s Sky, Subnautica' },
                        { suit: 'clubs', rank: 'Q', visual: 'ğŸ¦ ', title: 'Corruption', concept: 'Stop the spread.', example: 'Terraria, Horizon' },
                        { suit: 'clubs', rank: 'K', visual: 'ğŸ”', title: 'The Loop', concept: 'Break the cycle.', example: 'Deathloop, Returnal' },
                        { suit: 'clubs', rank: 'A', visual: 'ğŸ•¯ï¸', title: 'Sacrifice', concept: 'Give up everything.', example: 'Dark Souls, Hellblade' },
                        { suit: 'joker', rank: 'â˜…', visual: 'ğŸŒ', title: 'Open World', concept: 'Go anywhere.', example: 'Breath of the Wild, Elden Ring' }
                    ]
                },
                {
                    id: 'deck_5',
                    name: 'Genre Mashup',
                    description: 'Modern Trends',
                    themes: { hearts: "Action Mashup", spades: "Strategy Blend", diamonds: "RPG Hybrid", clubs: "Vibe Blend", joker: "Wildcard" },
                    cards: [
                        { suit: 'hearts', rank: '2', visual: 'ğŸ¸', title: 'Rhythm FPS', concept: 'Shoot on the beat.', example: 'Metal Hellsinger, Hi-Fi Rush' },
                        { suit: 'hearts', rank: '3', visual: 'ğŸ—¡ï¸', title: 'Melee Royale', concept: 'Battle Royale with swords.', example: 'Naraka, Rumbleverse' },
                        { suit: 'hearts', rank: '4', visual: 'ğŸƒ', title: 'Card Shooter', concept: 'Deckbuilding meets FPS.', example: 'Neon White, Friends vs Friends' },
                        { suit: 'hearts', rank: '5', visual: 'ğŸ§›', title: 'Survivors-like', concept: 'Bullet Hell + Idle stats.', example: 'Vampire Survivors, Brotato' },
                        { suit: 'hearts', rank: '6', visual: 'ğŸŒ¾', title: 'Action Farm', concept: 'Side-scrolling combat + Rice.', example: 'Sakuna, Dave the Diver' },
                        { suit: 'hearts', rank: '7', visual: 'ğŸ¥Š', title: 'Fighting RPG', concept: 'Street Fighter open world.', example: 'SF6 World Tour' },
                        { suit: 'hearts', rank: '8', visual: 'ğŸ“¸', title: 'Perspective Puzzle', concept: 'FPS mechanics solve logic.', example: 'Viewfinder, Superliminal' },
                        { suit: 'hearts', rank: '9', visual: 'ğŸ¥', title: 'Extraction Horror', concept: 'Get footage, get out.', example: 'Content Warning, Lethal Company' },
                        { suit: 'hearts', rank: '10', visual: 'ğŸ›£ï¸', title: 'MOBA Shooter', concept: 'Lanes + Aiming.', example: 'Deadlock, Overwatch 2' },
                        { suit: 'hearts', rank: 'J', visual: 'ğŸ¥·', title: 'Stealth Tactics', concept: 'RTS view + Ninja stealth.', example: 'Shadow Gambit, Desperados 3' },
                        { suit: 'hearts', rank: 'Q', visual: 'ğŸƒ', title: 'Platform Royale', concept: 'Wipeout course + PvP.', example: 'Fall Guys, Stumble Guys' },
                        { suit: 'hearts', rank: 'K', visual: 'ğŸ•µï¸', title: 'Social Shooter', concept: 'Spy vs Spy deduction.', example: 'Deceive Inc, The Finals' },
                        { suit: 'hearts', rank: 'A', visual: 'ğŸ”«', title: 'Roguelite FPS', concept: 'Run, Gun, Die, Repeat.', example: 'Gunfire Reborn, Roboquest' },
                        { suit: 'spades', rank: '2', visual: 'â›ˆï¸', title: 'Roguelite City', concept: 'Build a city against storms.', example: 'Against the Storm, Ratopia' },
                        { suit: 'spades', rank: '3', visual: 'ğŸ­', title: 'Factory Defense', concept: 'Automation + Tower Defense.', example: 'Factorio, Riftbreaker' },
                        { suit: 'spades', rank: '4', visual: 'ğŸœï¸', title: 'RTS 4X', concept: 'Grand scale in real time.', example: 'Dune: Spice Wars, Sins 2' },
                        { suit: 'spades', rank: '5', visual: 'â„ï¸', title: 'Narrative Colony', concept: 'Survival Sim + Moral Story.', example: 'Frostpunk 2, Rimworld' },
                        { suit: 'spades', rank: '6', visual: 'ğŸ£', title: 'Manage & Hunt', concept: 'Day: Action, Night: Tycoon.', example: 'Dave the Diver, Cult of the Lamb' },
                        { suit: 'spades', rank: '7', visual: 'ğŸ¹', title: 'Action TD', concept: 'Shooter + Tower Defense.', example: 'Orcs Must Die 3, Dome Keeper' },
                        { suit: 'spades', rank: '8', visual: 'â™Ÿï¸', title: 'Horror Tactics', concept: 'Turn-based dread.', example: 'Othercide, Darkest Dungeon 2' },
                        { suit: 'spades', rank: '9', visual: 'ğŸ“¦', title: 'Cozy Puzzle', concept: 'Organizing as gameplay.', example: 'Unpacking, Wilmot\'s Warehouse' },
                        { suit: 'spades', rank: '10', visual: 'ğŸ”«', title: 'Pal-Like', concept: 'Monster Taming + Guns/Survival.', example: 'Palworld, Craftopia' },
                        { suit: 'spades', rank: 'J', visual: 'ğŸƒ', title: 'Card Strategy', concept: '4X/RTS simplified to cards.', example: 'Songs of Silence, Dune Imperium' },
                        { suit: 'spades', rank: 'Q', visual: 'ğŸ’', title: 'Inventory Battler', concept: 'Tetris inventory PvP.', example: 'Backpack Battles' },
                        { suit: 'spades', rank: 'K', visual: 'ğŸŒ¿', title: 'Reverse City', concept: 'Build nature, remove city.', example: 'Terra Nil, Cloud Gardens' },
                        { suit: 'spades', rank: 'A', visual: 'ğŸª“', title: 'Voxel RPG', concept: 'Minecraft + Dark Souls/Zelda.', example: 'Enshrouded, Valheim' },
                        { suit: 'diamonds', rank: '2', visual: 'ğŸ’', title: 'Open Souls', concept: 'Souls combat in open world.', example: 'Elden Ring, Lords of the Fallen' },
                        { suit: 'diamonds', rank: '3', visual: 'ğŸ£', title: 'Metroid-Tamer', concept: 'Platforming with pets.', example: 'Monster Sanctuary, Cassette Beasts' },
                        { suit: 'diamonds', rank: '4', visual: 'â­', title: 'Active Turn', concept: 'Turn-based + Timing hits.', example: 'Sea of Stars, Yakuza: Like a Dragon' },
                        { suit: 'diamonds', rank: '5', visual: 'ğŸ°', title: 'Poker Rogue', concept: 'Gambling mechanics used for combat.', example: 'Balatro, Dungeons & Degenerate Gamblers' },
                        { suit: 'diamonds', rank: '6', visual: 'â›³', title: 'Sports RPG', concept: 'Save the world via Golf.', example: 'Sports Story, Dodgeball Academia' },
                        { suit: 'diamonds', rank: '7', visual: 'ğŸ±', title: 'Physics RPG', concept: 'Pachinko/Pinball damage.', example: 'Peglin, Creature in the Well' },
                        { suit: 'diamonds', rank: '8', visual: 'ğŸ°', title: 'Dungeon Royale', concept: 'PvPvE dungeon crawler.', example: 'Dark and Darker, Dungeonborne' },
                        { suit: 'diamonds', rank: '9', visual: 'ğŸ¡', title: 'Cozy MMO', concept: 'WoW without the war.', example: 'Palia, Sky: Children of Light' },
                        { suit: 'diamonds', rank: '10', visual: 'ğŸ¦¾', title: 'Shooter RPG', concept: 'Deep RPG stats in FPS.', example: 'Cyberpunk 2077, Starfield' },
                        { suit: 'diamonds', rank: 'J', visual: 'ğŸ²', title: 'Dating CRPG', concept: 'Hardcore D&D + Romance.', example: 'Baldur\'s Gate 3, Boyfriend Dungeon' },
                        { suit: 'diamonds', rank: 'Q', visual: 'ğŸ²', title: 'Dice Rogue', concept: 'Yahtzee as combat.', example: 'Dicey Dungeons, Slice & Dice' },
                        { suit: 'diamonds', rank: 'K', visual: 'ğŸ’°', title: 'Shopkeeper RPG', concept: 'Run the item shop.', example: 'Moonlighter, Potionomics' },
                        { suit: 'diamonds', rank: 'A', visual: 'â™Ÿï¸', title: 'Social Tactics', concept: 'Grid combat + Hangouts.', example: 'Persona 5 Tactica, Marvel Midnight Suns' },
                        { suit: 'clubs', rank: '2', visual: 'ğŸ£', title: 'Eldritch Fish', concept: 'Relaxing fishing + Horror.', example: 'Dredge, Dave the Diver' },
                        { suit: 'clubs', rank: '3', visual: 'ğŸ³', title: 'Cooking Rogue', concept: 'Restaurant chaos run.', example: 'PlateUp!, Overcooked' },
                        { suit: 'clubs', rank: '4', visual: 'ğŸ“–', title: 'VN Strategy', concept: 'Novel + Grid Combat.', example: 'Digimon Survive, 13 Sentinels' },
                        { suit: 'clubs', rank: '5', visual: 'âŒ¨ï¸', title: 'Typing Exorcism', concept: 'Bullet hell + Typing.', example: 'The Textorcist, Epistory' },
                        { suit: 'clubs', rank: '6', visual: 'ğŸ§©', title: 'Rule Breaker', concept: 'Change the game rules.', example: 'Baba Is You, Patrick\'s Parabox' },
                        { suit: 'clubs', rank: '7', visual: 'ğŸ“¹', title: 'Viral Horror', concept: 'Scary game about streaming.', example: 'Content Warning, Parasocial' },
                        { suit: 'clubs', rank: '8', visual: 'ğŸš¶', title: 'Puzzle Walker', concept: 'Walking Sim + Deep Logic.', example: 'The Witness, Talos Principle 2' },
                        { suit: 'clubs', rank: '9', visual: 'ğŸš—', title: 'Drive Survival', concept: 'Station Wagon vs Zone.', example: 'Pacific Drive, Jalopy' },
                        { suit: 'clubs', rank: '10', visual: 'ğŸ§¹', title: 'Job Sim', concept: 'Work is fun.', example: 'PowerWash Sim, Hardspace: Shipbreaker' },
                        { suit: 'clubs', rank: 'J', visual: 'ğŸ²', title: 'Digital Board', concept: 'Party game physics.', example: 'Tabletop Simulator, Pummel Party' },
                        { suit: 'clubs', rank: 'Q', visual: 'ğŸ«', title: 'Edutainment Horror', concept: 'Kids game gone wrong.', example: 'Baldi\'s Basics, Poppy Playtime' },
                        { suit: 'clubs', rank: 'K', visual: 'ğŸ¤', title: 'Musical RPG', concept: 'Dialogue is a song.', example: 'Stray Gods, Goodbye Volcano High' },
                        { suit: 'clubs', rank: 'A', visual: 'ğŸ”„', title: 'Idle RPG', concept: 'Game plays itself... mostly.', example: 'Melvor Idle, Loop Hero' },
                        { suit: 'joker', rank: 'â˜…', visual: 'ğŸ’¾', title: 'Meta Tycoon', concept: 'Simulate the industry.', example: 'Game Dev Story, Game Dev Tycoon' }
                    ]
                }
            ]
        };

        // ==========================================
        // APP LOGIC
        // ==========================================

        const app = {
            state: {
                activeDeckIds: {}, // Keyed by deck ID (e.g., 'deck_1': true)
                currentDeck: [],
                drawIndex: 0,
                keptCards: [],
                burnedCardIds: [],
                view: 'draw',
                animating: false,
                mobileMenuOpen: false
            },

            init() {
                // Set titles
                document.getElementById('app-title').innerText = APP_CONFIG.title;
                document.getElementById('app-version').innerText = APP_CONFIG.version;

                this.renderDeckToggles();

                // Load State
                const loaded = this.loadState();
                
                // Default to first deck if nothing active
                if (!loaded || Object.keys(this.state.activeDeckIds).length === 0) {
                    this.state.activeDeckIds = { [APP_CONFIG.decks[0].id]: true };
                    this.shuffleDecks();
                } else {
                    // Filter out burned cards
                    if (this.state.burnedCardIds.length > 0) {
                        this.state.currentDeck = this.state.currentDeck.filter(c => !this.state.burnedCardIds.includes(c.id));
                        if(this.state.currentDeck.length === 0) this.shuffleDecks();
                    }
                }
                
                this.render();
                this.setupGestures();
            },

            // --- Helper: Generate IDs for Cards on Runtime ---
            // This ensures every card has a unique ID based on its deck and properties
            flattenDeckData() {
                // We don't store flattened data permanently to allow config changes to flow through
                // But we need a lookup map.
                let allCards = [];
                APP_CONFIG.decks.forEach(deck => {
                    deck.cards.forEach(card => {
                        // Create a stable ID: deckId-suit-rank
                        const id = `${deck.id}-${card.suit}-${card.rank}`;
                        // Attach deck ID metadata to the card object copy
                        allCards.push({ ...card, id: id, _deckId: deck.id });
                    });
                });
                return allCards;
            },

            getCardMap() {
                const map = {};
                this.flattenDeckData().forEach(c => map[c.id] = c);
                return map;
            },

            // --- Persistence ---
            saveState() {
                try {
                    const stateToSave = {
                        activeDeckIds: this.state.activeDeckIds,
                        currentDeckIds: this.state.currentDeck.map(c => c.id),
                        drawIndex: this.state.drawIndex,
                        keptCardIds: this.state.keptCards.map(c => c.id),
                        burnedCardIds: this.state.burnedCardIds
                    };
                    localStorage.setItem('gamedeck_state_v4', JSON.stringify(stateToSave));
                } catch (e) { console.error("Save failed", e); }
            },

            loadState() {
                const json = localStorage.getItem('gamedeck_state_v4');
                if(!json) return false;
                
                try {
                    const saved = JSON.parse(json);
                    const cardMap = this.getCardMap();

                    this.state.activeDeckIds = saved.activeDeckIds || {};
                    this.state.drawIndex = saved.drawIndex || 0;
                    this.state.burnedCardIds = saved.burnedCardIds || [];
                    
                    if (saved.currentDeckIds && saved.currentDeckIds.length > 0) {
                        this.state.currentDeck = saved.currentDeckIds.map(id => cardMap[id]).filter(Boolean);
                    }
                    
                    if (saved.keptCardIds) {
                        this.state.keptCards = saved.keptCardIds.map(id => cardMap[id]).filter(Boolean);
                    }
                    return true;
                } catch(e) { console.error("Load failed", e); return false; }
            },

            // --- Core Logic ---
            toggleMobileMenu() {
                this.state.mobileMenuOpen = !this.state.mobileMenuOpen;
                this.render();
            },

            shuffleDecks() {
                let combined = [];
                const cardMap = this.getCardMap(); // Get cards with generated IDs and meta

                // Gather cards from active decks
                Object.keys(this.state.activeDeckIds).forEach(deckId => {
                    if (this.state.activeDeckIds[deckId]) {
                        const deckCards = Object.values(cardMap).filter(c => c._deckId === deckId);
                        combined = [...combined, ...deckCards];
                    }
                });

                if(combined.length === 0) {
                    // Fallback to first deck
                    const firstDeckId = APP_CONFIG.decks[0].id;
                    this.state.activeDeckIds[firstDeckId] = true;
                    combined = Object.values(cardMap).filter(c => c._deckId === firstDeckId);
                }

                // Filter burn
                combined = combined.filter(c => !this.state.burnedCardIds.includes(c.id));

                // Restoration fallback
                if (combined.length === 0) {
                    this.state.burnedCardIds = [];
                    // Refetch
                    Object.keys(this.state.activeDeckIds).forEach(deckId => {
                         if (this.state.activeDeckIds[deckId]) {
                            const deckCards = Object.values(cardMap).filter(c => c._deckId === deckId);
                            combined = [...combined, ...deckCards];
                        }
                    });
                }

                // Fisher-Yates
                for (let i = combined.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [combined[i], combined[j]] = [combined[j], combined[i]];
                }

                this.state.currentDeck = combined;
                this.state.drawIndex = 0;
                this.saveState();
            },

            toggleDeck(id) {
                const newState = !this.state.activeDeckIds[id];
                const newActiveIds = { ...this.state.activeDeckIds, [id]: newState };
                
                // Prevent disabling all
                if (!Object.values(newActiveIds).some(Boolean)) return;

                this.state.activeDeckIds = newActiveIds;
                this.shuffleDecks();
                this.render();
            },

            setView(viewName) {
                this.state.view = viewName;
                this.state.mobileMenuOpen = false;
                this.render();
            },

            // --- Action Logic ---
            discard() {
                if (this.state.animating) return;
                const el = document.getElementById('card-wrapper')?.firstElementChild;
                if (el) {
                    el.classList.add('card-discard-left');
                    this.animateAdvance();
                }
            },
            keep() {
                if (this.state.animating) return;
                const el = document.getElementById('card-wrapper')?.firstElementChild;
                const card = this.state.currentDeck[this.state.drawIndex];
                if (el && card) {
                    el.classList.add('card-keep-right');
                    if (!this.state.keptCards.find(c => c.id === card.id)) {
                        this.state.keptCards.push(card);
                        this.saveState();
                    }
                    this.animateAdvance();
                }
            },
            burn() {
                if (this.state.animating) return;
                const el = document.getElementById('card-wrapper')?.firstElementChild;
                const card = this.state.currentDeck[this.state.drawIndex];
                if (el && card) {
                    el.classList.add('card-burn');
                    if (!this.state.burnedCardIds.includes(card.id)) {
                        this.state.burnedCardIds.push(card.id);
                        this.saveState();
                    }
                    this.animateAdvance(400);
                }
            },
            reshuffle(manual = false) {
                if (this.state.animating) return;
                const el = document.getElementById('card-wrapper')?.firstElementChild;
                if (el) {
                    el.style.transition = 'all 0.2s ease-in';
                    el.style.opacity = '0';
                    el.style.transform = 'scale(0.9)';
                }
                this.state.animating = true;
                setTimeout(() => {
                    this.shuffleDecks();
                    this.state.animating = false;
                    this.render(true);
                }, 250);
            },
            animateAdvance(delay = 300) {
                this.state.animating = true;
                setTimeout(() => {
                    this.advanceDeck();
                    this.state.animating = false;
                    this.render();
                }, delay);
            },
            advanceDeck() {
                if (this.state.drawIndex >= this.state.currentDeck.length - 1) {
                    this.shuffleDecks();
                    this.render(true);
                } else {
                    this.state.drawIndex++;
                    this.saveState();
                }
            },
            restoreBurned(id) {
                this.state.burnedCardIds = this.state.burnedCardIds.filter(bid => bid !== id);
                this.saveState();
                this.render();
            },
            clearSaved() {
                this.state.keptCards = [];
                this.saveState();
                this.render();
            },
            removeSaved(id) {
                this.state.keptCards = this.state.keptCards.filter(c => c.id !== id);
                this.saveState();
                this.render();
            },

            // --- Display Helpers ---
            getDeckConfig(deckId) {
                return APP_CONFIG.decks.find(d => d.id === deckId) || {};
            },
            
            getSuitConfig(suitKey) {
                return APP_CONFIG.suits[suitKey] || { label: suitKey, icon: 'circle', color: 'slate' };
            },

            // --- HTML Generators ---
            renderDeckToggles() {
                const container = document.getElementById('deck-toggle-list');
                if(!container) return;
                
                container.innerHTML = APP_CONFIG.decks.map(deck => `
                    <button onclick="app.toggleDeck('${deck.id}')" id="btn-deck-${deck.id}" class="w-full flex items-center justify-between p-3 md:p-2 rounded border text-sm border-slate-700 text-slate-500 transition-colors">
                        <span>${deck.name}</span>
                        <div class="indicator w-2 h-2 rounded-full bg-indigo-500 hidden"></div>
                    </button>
                `).join('');
            },

            renderCardHTML(card, animationClass = '') {
                const deckConfig = this.getDeckConfig(card._deckId);
                const suitConfig = this.getSuitConfig(card.suit);
                const theme = deckConfig.themes?.[card.suit] || "";
                
                const isRed = suitConfig.color === 'red';
                const textColor = isRed ? 'text-red-600' : 'text-slate-800';
                const borderColor = isRed ? 'border-red-200' : 'border-slate-200';
                const bgGradient = isRed ? 'from-red-50 to-white' : 'from-slate-50 to-white';
                const iconColor = isRed ? 'text-red-500' : 'text-slate-700'; // For Gallery/smaller icons

                return `
                <div class="w-full h-full rounded-2xl shadow-2xl border-4 ${borderColor} bg-gradient-to-br ${bgGradient} flex flex-col p-4 relative overflow-hidden select-none bg-white ${animationClass}">
                    <div class="absolute top-0 left-0 right-0 flex justify-center pt-2">
                        <span class="text-[9px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full bg-black/5 text-black/40">
                            ${deckConfig.name || 'Unknown Deck'}
                        </span>
                    </div>
                    <div class="absolute top-4 left-4 flex flex-col items-center leading-none ${textColor}">
                        <span class="text-3xl font-bold font-serif">${card.rank}</span>
                        <i data-lucide="${suitConfig.icon}" class="w-4 h-4 fill-current"></i>
                    </div>
                    <div class="absolute bottom-4 right-4 flex flex-col items-center leading-none ${textColor} transform rotate-180">
                        <span class="text-3xl font-bold font-serif">${card.rank}</span>
                        <i data-lucide="${suitConfig.icon}" class="w-4 h-4 fill-current"></i>
                    </div>
                    <div class="flex-1 flex flex-col items-center justify-center text-center mt-6 z-10">
                        <div class="text-6xl mb-2 drop-shadow-sm filter">${card.visual}</div>
                        <div class="text-[10px] uppercase font-bold tracking-widest opacity-60 mb-1 ${textColor}">${theme}</div>
                        <h2 class="text-xl font-bold uppercase tracking-tight mb-1 ${textColor}">${card.title}</h2>
                        <div class="w-12 h-0.5 bg-black/10 mb-3"></div>
                        <p class="text-sm font-medium text-slate-600 mb-2 px-2 italic leading-relaxed">"${card.concept}"</p>
                        <div class="mt-auto mb-16 bg-white/60 backdrop-blur-sm rounded-lg p-2 text-xs text-slate-500 border border-black/5 w-full">
                            <span class="font-bold block mb-0.5 text-slate-400 uppercase text-[9px]">Examples</span>
                            <span class="text-slate-700 font-medium">${card.example}</span>
                        </div>
                    </div>
                </div>`;
            },

            render(isReshuffle = false) {
                const content = document.getElementById('main-content');
                const sidebar = document.getElementById('sidebar-content');
                
                // Sidebar & Mobile Menu State
                if (this.state.mobileMenuOpen) {
                    sidebar.classList.remove('hidden');
                    document.getElementById('menu-icon').setAttribute('data-lucide', 'x');
                } else {
                    sidebar.classList.add('hidden');
                    document.getElementById('menu-icon').setAttribute('data-lucide', 'menu');
                }

                // Navbar Active State
                document.querySelectorAll('nav button').forEach(el => el.classList.remove('bg-indigo-600', 'text-white'));
                const activeNav = document.getElementById(`nav-${this.state.view}`);
                if(activeNav) activeNav.classList.add('bg-indigo-600', 'text-white');

                // Update Deck Toggle Buttons
                APP_CONFIG.decks.forEach(deck => {
                    const btn = document.getElementById(`btn-deck-${deck.id}`);
                    if (!btn) return;
                    if (this.state.activeDeckIds[deck.id]) {
                        btn.classList.add('bg-slate-800', 'border-indigo-500/50', 'text-indigo-300');
                        btn.querySelector('.indicator').classList.remove('hidden');
                    } else {
                        btn.classList.remove('bg-slate-800', 'border-indigo-500/50', 'text-indigo-300');
                        btn.querySelector('.indicator').classList.add('hidden');
                    }
                });

                document.getElementById('saved-count').innerText = this.state.keptCards.length;

                // Render Views
                if (this.state.view === 'draw') {
                    const tpl = document.getElementById('tpl-draw');
                    if (content.innerHTML === '') content.innerHTML = tpl.innerHTML;
                    if (!document.getElementById('card-wrapper')) content.innerHTML = tpl.innerHTML;

                    const activeCount = Object.values(this.state.activeDeckIds).filter(Boolean).length;
                    document.getElementById('deck-label').innerText = activeCount > 1 ? `Combined Deck (${activeCount})` : 'Single Deck';
                    
                    const currentCard = this.state.currentDeck[this.state.drawIndex];
                    if (currentCard) {
                        document.getElementById('card-counter').innerText = `Card ${this.state.drawIndex + 1} of ${this.state.currentDeck.length}`;
                        const anim = isReshuffle ? 'card-reshuffle-enter' : 'card-enter';
                        document.getElementById('card-wrapper').innerHTML = this.renderCardHTML(currentCard, anim);
                    } else {
                        document.getElementById('card-wrapper').innerHTML = '<div class="flex items-center justify-center h-full text-slate-400">Deck Empty</div>';
                    }
                    this.setupGestures();

                } else if (this.state.view === 'saved') {
                    const tpl = document.getElementById('tpl-saved');
                    content.innerHTML = tpl.innerHTML;
                    
                    if (this.state.keptCards.length === 0) {
                        document.getElementById('empty-state').classList.remove('hidden');
                        document.getElementById('saved-grid').classList.add('hidden');
                    } else {
                        const grid = document.getElementById('saved-grid');
                        grid.innerHTML = this.state.keptCards.map(card => {
                            const deckConf = this.getDeckConfig(card._deckId);
                            const suitConf = this.getSuitConfig(card.suit);
                            return `
                            <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-200 flex items-start space-x-4 relative overflow-hidden">
                                <div class="absolute top-0 left-0 bg-slate-100 text-[8px] px-2 font-bold uppercase text-slate-400">${deckConf.name}</div>
                                <div class="text-4xl bg-slate-50 p-2 rounded-lg border border-slate-100 mt-2">${card.visual}</div>
                                <div class="mt-2">
                                    <h3 class="font-bold text-slate-800">${card.title}</h3>
                                    <p class="text-xs text-slate-500 uppercase tracking-wide mb-1">${card.concept}</p>
                                    <p class="text-sm text-slate-600 leading-snug">"${card.example}"</p>
                                    <button onclick="app.removeSaved('${card.id}')" class="text-xs text-red-400 hover:text-red-600 mt-2 flex items-center">Remove</button>
                                </div>
                            </div>`;
                        }).join('');
                    }

                } else if (this.state.view === 'gallery') {
                    const tpl = document.getElementById('tpl-gallery');
                    content.innerHTML = tpl.innerHTML;
                    const gallery = document.getElementById('gallery-content');
                    
                    // Generate Gallery by active decks first, or grouped by Suit? 
                    // Previous version was grouped by Suit across all decks. Let's maintain that but dynamic.
                    
                    // Create map of active cards
                    const cardMap = this.getCardMap();
                    let allActiveCards = [];
                    Object.keys(this.state.activeDeckIds).forEach(dId => {
                         if(this.state.activeDeckIds[dId]) {
                             allActiveCards = [...allActiveCards, ...Object.values(cardMap).filter(c => c._deckId === dId)];
                         }
                    });

                    // Order of suits from config
                    Object.keys(APP_CONFIG.suits).forEach(suitKey => {
                        const suitConf = APP_CONFIG.suits[suitKey];
                        const cards = allActiveCards.filter(c => c.suit === suitKey)
                            .sort((a,b) => {
                                // Simple rank sort logic
                                const order = ['2','3','4','5','6','7','8','9','10','J','Q','K','A','â˜…'];
                                return order.indexOf(a.rank) - order.indexOf(b.rank);
                            });
                        
                        if (cards.length === 0) return;

                        const isRed = suitConf.color === 'red';
                        const colorClass = isRed ? 'text-red-600' : 'text-slate-700';
                        const iconColor = isRed ? 'text-red-500' : 'text-slate-700';

                        gallery.innerHTML += `
                        <div class="mb-10">
                            <div class="flex items-center space-x-2 border-b ${isRed ? 'border-red-200' : 'border-slate-200'} pb-2 mb-4">
                                <i data-lucide="${suitConf.icon}" class="${iconColor} w-4 h-4 fill-current"></i>
                                <h3 class="text-lg font-bold uppercase tracking-wider ${colorClass}">${suitConf.label}</h3>
                                <span class="text-xs text-slate-400 ml-auto font-mono bg-slate-100 px-2 py-0.5 rounded-full">${cards.length} Cards</span>
                            </div>
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                                ${cards.map(c => {
                                    const isBurned = this.state.burnedCardIds.includes(c.id);
                                    const opacityClass = isBurned ? 'opacity-50 grayscale hover:grayscale-0 hover:opacity-100' : '';
                                    const burnedOverlay = isBurned ? `<div class="absolute inset-0 bg-slate-900/10 flex items-center justify-center z-20 pointer-events-none group-hover:hidden"><div class="bg-black/70 text-white text-[10px] uppercase font-bold px-2 py-1 rounded-full">Burned</div></div>` : '';
                                    const deckConf = this.getDeckConfig(c._deckId);
                                    
                                    return `
                                    <div onclick="${isBurned ? `app.restoreBurned('${c.id}')` : ''}" class="cursor-pointer ${opacityClass} bg-white rounded-lg p-3 shadow-sm border border-slate-200 hover:border-indigo-300 transition-all flex flex-col items-center text-center relative overflow-hidden group">
                                        ${burnedOverlay}
                                        <div class="absolute top-1 right-2 text-[8px] font-bold uppercase text-slate-300">${deckConf.name.split(' ')[0]}</div>
                                        <div class="text-2xl mb-1 z-10">${c.visual}</div>
                                        <div class="text-xs font-bold uppercase z-10 ${colorClass}">${c.rank}</div>
                                        <div class="font-bold text-slate-800 text-sm leading-tight mt-1 z-10">${c.title}</div>
                                        <div class="text-[10px] text-slate-500 mt-1 z-10 opacity-80 line-clamp-2">${c.concept}</div>
                                        <div class="absolute top-0 right-0 p-1 opacity-10 group-hover:opacity-20 ${iconColor}">
                                            <i data-lucide="${suitConf.icon}" class="w-10 h-10 fill-current"></i>
                                        </div>
                                    </div>`;
                                }).join('')}
                            </div>
                        </div>`;
                    });
                }
                
                lucide.createIcons();
            },

            setupGestures() {
                const wrapper = document.getElementById('card-wrapper');
                if(!wrapper) return;
                
                // Remove old listeners? The wrapper is often re-created, so adding new ones is generally fine 
                // as long as we don't leak memory in SPA. Here we rely on innerHTML replacement clearing them.
                wrapper.addEventListener('touchstart', (e) => {
                    this.touchEnd = null;
                    this.touchStart = { x: e.targetTouches[0].clientX, y: e.targetTouches[0].clientY };
                });
                wrapper.addEventListener('touchmove', (e) => this.touchEnd = { x: e.targetTouches[0].clientX, y: e.targetTouches[0].clientY });
                wrapper.addEventListener('touchend', () => {
                    if (!this.touchStart || !this.touchEnd) return;
                    const dX = this.touchStart.x - this.touchEnd.x;
                    const dY = this.touchStart.y - this.touchEnd.y;
                    if (Math.abs(dX) > Math.abs(dY)) {
                        if (dX > 50) this.discard();
                        else if (dX < -50) this.keep();
                    } else {
                        if (dY < -50) this.reshuffle(true);
                    }
                });
            }
        };

        document.addEventListener('DOMContentLoaded', () => app.init());
    </script>
</body>
</html>
