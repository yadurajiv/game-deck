<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GameDeck - Ideation Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,700;1,400&family=Inter:wght@400;500;600;700&display=swap');
        
        body { font-family: 'Inter', sans-serif; }
        .font-serif { font-family: 'Crimson Text', serif; }
        
        /* Card Animations */
        .card-container {
            perspective: 1000px;
        }
        
        .card-enter {
            animation: cardEnter 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        }
        
        .card-discard-left {
            animation: discardLeft 0.3s ease-in forwards;
        }
        
        .card-keep-right {
            animation: keepRight 0.3s ease-in forwards;
        }
        
        .card-burn {
            animation: burnCard 0.4s ease-in forwards;
        }

        .card-reshuffle-enter {
            animation: reshuffleEnter 0.5s ease-out forwards;
        }

        @keyframes cardEnter {
            from { opacity: 0; transform: translateY(40px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        @keyframes discardLeft {
            to { opacity: 0; transform: translateX(-120%) rotate(-20deg); }
        }

        @keyframes keepRight {
            to { opacity: 0; transform: translateX(120%) rotate(20deg); }
        }

        @keyframes burnCard {
            0% { transform: scale(1); filter: grayscale(0%); }
            50% { transform: scale(0.9); filter: grayscale(100%) brightness(0.5); }
            100% { transform: scale(0) translateY(50px); opacity: 0; }
        }

        @keyframes reshuffleEnter {
            0% { transform: translateY(-50px) scale(0.9); opacity: 0; }
            50% { transform: translateY(10px) scale(1.02); opacity: 1; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-900 h-[100dvh] flex flex-col md:flex-row overflow-hidden">

    <!-- Sidebar / Header -->
    <div class="bg-slate-900 text-slate-300 w-full md:w-64 flex-shrink-0 flex flex-col border-b md:border-r border-slate-700 z-50 relative">
        <!-- Top Bar -->
        <div class="p-4 flex justify-between items-center h-16 bg-slate-900 z-50 relative">
            <div class="flex items-center space-x-2">
                <i data-lucide="layers" class="text-indigo-400"></i>
                <h1 class="font-bold text-white tracking-wide">GameDeck</h1>
            </div>
            <div class="flex items-center gap-3">
                <span class="text-xs bg-indigo-900 text-indigo-300 px-2 py-0.5 rounded-full">v3.4</span>
                <button onclick="app.toggleMobileMenu()" class="md:hidden text-slate-400 hover:text-white transition-colors p-1">
                    <i data-lucide="menu" id="menu-icon" class="w-6 h-6"></i>
                </button>
            </div>
        </div>

        <!-- Collapsible Content (Nav + Settings) -->
        <div id="sidebar-content" class="hidden md:flex flex-col flex-1 bg-slate-900/95 backdrop-blur-md md:backdrop-blur-none md:bg-transparent absolute md:relative top-16 md:top-0 left-0 w-full md:w-auto h-[calc(100dvh-4rem)] md:h-auto z-40 md:z-auto border-b md:border-0 border-slate-700 md:shadow-none overflow-y-auto md:overflow-visible transition-all">
            
            <!-- Navigation -->
            <nav class="flex flex-col p-2 space-y-1">
                <button onclick="app.setView('draw')" id="nav-draw" class="flex items-center px-3 py-3 md:py-2 rounded-lg text-sm font-medium transition-colors hover:bg-slate-800 w-full text-left">
                    <i data-lucide="sparkles" class="mr-3 md:mr-2 w-5 h-5 md:w-4 md:h-4"></i> Draw
                </button>
                <button onclick="app.setView('saved')" id="nav-saved" class="flex items-center px-3 py-3 md:py-2 rounded-lg text-sm font-medium transition-colors hover:bg-slate-800 w-full text-left">
                    <i data-lucide="save" class="mr-3 md:mr-2 w-5 h-5 md:w-4 md:h-4"></i> Saved Hand 
                    <span id="saved-count" class="ml-auto bg-slate-800 px-2 py-0.5 rounded-full text-xs">0</span>
                </button>
                <button onclick="app.setView('gallery')" id="nav-gallery" class="flex items-center px-3 py-3 md:py-2 rounded-lg text-sm font-medium transition-colors hover:bg-slate-800 w-full text-left">
                    <i data-lucide="grid" class="mr-3 md:mr-2 w-5 h-5 md:w-4 md:h-4"></i> Gallery
                </button>
            </nav>

            <!-- Deck Settings -->
            <div class="mt-auto p-4 border-t border-slate-800 overflow-y-auto no-scrollbar pb-8 md:pb-4">
                <h3 class="text-xs font-bold uppercase text-slate-500 mb-3 tracking-wider">Active Decks</h3>
                <div class="space-y-2">
                    <button onclick="app.toggleDeck(1)" id="btn-deck-1" class="w-full flex items-center justify-between p-3 md:p-2 rounded border text-sm border-slate-700 text-slate-500 transition-colors">
                        <span>1. Creative Ways</span>
                        <div class="indicator w-2 h-2 rounded-full bg-indigo-500 hidden"></div>
                    </button>
                    <button onclick="app.toggleDeck(2)" id="btn-deck-2" class="w-full flex items-center justify-between p-3 md:p-2 rounded border text-sm border-slate-700 text-slate-500 transition-colors">
                        <span>2. Adv. Mechanics</span>
                        <div class="indicator w-2 h-2 rounded-full bg-indigo-500 hidden"></div>
                    </button>
                    <button onclick="app.toggleDeck(3)" id="btn-deck-3" class="w-full flex items-center justify-between p-3 md:p-2 rounded border text-sm border-slate-700 text-slate-500 transition-colors">
                        <span>3. Aesthetics</span>
                        <div class="indicator w-2 h-2 rounded-full bg-indigo-500 hidden"></div>
                    </button>
                    <button onclick="app.toggleDeck(4)" id="btn-deck-4" class="w-full flex items-center justify-between p-3 md:p-2 rounded border text-sm border-slate-700 text-slate-500 transition-colors">
                        <span>4. World & Setting</span>
                        <div class="indicator w-2 h-2 rounded-full bg-indigo-500 hidden"></div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-1 relative overflow-y-auto bg-slate-100 p-2 md:p-8" id="main-content">
        <!-- Views will be injected here -->
    </main>

    <!-- Templates -->
    
    <!-- Draw View Template -->
    <template id="tpl-draw">
        <div class="min-h-full flex flex-col items-center justify-center max-w-lg mx-auto w-full py-2 md:py-4">
            <div class="mb-2 md:mb-6 text-center">
                <span id="deck-label" class="text-xs font-bold uppercase tracking-widest text-slate-400">Combined Deck</span>
                <p id="card-counter" class="text-slate-500 text-sm mt-0.5 md:mt-1">Card 1 of 50</p>
            </div>

            <div id="card-wrapper" class="card-container w-72 h-96 relative touch-none select-none shadow-xl rounded-2xl flex-shrink-0 bg-slate-200">
                <!-- Card render here -->
            </div>

            <p class="md:hidden text-xs text-indigo-400 mt-4 md:mt-6 flex items-center justify-center gap-4 opacity-70">
                <span>â† Discard</span>
                <span>â€¢</span>
                <span>Keep â†’</span>
            </p>

            <div class="flex gap-3 md:gap-4 mt-4 md:mt-8 w-full max-w-xs px-2 md:px-0">
                <button onclick="app.discard()" class="flex-1 flex flex-col items-center justify-center p-3 md:p-4 bg-white border border-slate-200 rounded-xl shadow-sm hover:shadow-md hover:bg-slate-50 transition-all group active:scale-95">
                    <i data-lucide="trash-2" class="text-slate-400 group-hover:text-red-500 mb-1 w-5 h-5"></i>
                    <span class="text-xs font-bold text-slate-500">Discard</span>
                </button>

                <!-- Burn Button -->
                <button onclick="app.burn()" class="w-12 flex flex-col items-center justify-center p-3 md:p-4 bg-slate-200 rounded-xl shadow-sm hover:bg-slate-300 transition-all group active:scale-95" title="Burn (Remove from Deck)">
                    <i data-lucide="flame" class="text-slate-500 group-hover:text-orange-500 mb-1 w-5 h-5"></i>
                </button>

                <button onclick="app.keep()" class="flex-1 flex flex-col items-center justify-center p-3 md:p-4 bg-indigo-600 rounded-xl shadow-lg shadow-indigo-200 hover:bg-indigo-500 hover:shadow-indigo-300 transition-all transform hover:-translate-y-1 active:scale-95">
                    <i data-lucide="save" class="text-white mb-1 w-5 h-5"></i>
                    <span class="text-xs font-bold text-white">Keep</span>
                </button>
            </div>
            
            <button onclick="app.reshuffle(true)" class="mt-4 md:mt-8 flex items-center text-slate-400 hover:text-indigo-600 text-xs font-bold uppercase tracking-widest transition-colors p-2 mb-safe">
                <i data-lucide="refresh-cw" class="mr-2 w-3 h-3"></i> Reshuffle Deck
            </button>
        </div>
    </template>

    <!-- Saved View Template -->
    <template id="tpl-saved">
        <div class="max-w-5xl mx-auto w-full pt-4 px-2 md:px-0">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-slate-800">Your Hand</h2>
                <button onclick="app.clearSaved()" class="text-red-500 text-sm font-medium hover:text-red-700 flex items-center bg-white px-3 py-1.5 rounded-lg border border-red-100 shadow-sm">
                    <i data-lucide="trash-2" class="mr-1 w-4 h-4"></i> Clear All
                </button>
            </div>
            <div id="saved-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 pb-20">
                <!-- Saved cards injected here -->
            </div>
            <div id="empty-state" class="hidden text-center py-20 border-2 border-dashed border-slate-300 rounded-xl">
                <div class="text-4xl mb-4">ğŸ«¥</div>
                <p class="text-slate-500 font-medium">No cards saved yet.</p>
                <button onclick="app.setView('draw')" class="text-indigo-600 font-bold text-sm mt-2 hover:underline">Go draw some!</button>
            </div>
        </div>
    </template>

    <!-- Gallery View Template -->
    <template id="tpl-gallery">
        <div class="max-w-6xl mx-auto pb-10 w-full pt-4 px-2 md:px-0">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-slate-800">Full Deck Gallery</h2>
                <p class="text-sm text-slate-500 mt-1">Showing all cards from active decks. <span class="text-orange-600 font-medium">Burned cards</span> are dimmed; tap to restore.</p>
            </div>
            <div id="gallery-content">
                <!-- Gallery Groups Injected Here -->
            </div>
        </div>
    </template>

    <script>
        // --- Data Definitions (Expanded with more examples) ---
        
        const DECK_1 = [
            { id: '1-h2', deck: 1, suit: 'hearts', rank: '2', visual: 'ğŸ•¹ï¸', title: 'Combine Games', concept: 'Mix aspects from different games.', example: 'Monopoly GO!, Palworld, Craftopia' },
            { id: '1-h3', deck: 1, suit: 'hearts', rank: '3', visual: 'ğŸŒ€', title: 'Mix Elements', concept: 'Blend mechanics for hybrid synergy.', example: 'SSSnaker, Archero, Puzzle & Dragons' },
            { id: '1-h4', deck: 1, suit: 'hearts', rank: '4', visual: 'ğŸŒ', title: 'Simplify', concept: 'Simplify mid-core for casuals.', example: 'Free Fire, Brawl Stars, Marvel Snap' },
            { id: '1-h5', deck: 1, suit: 'hearts', rank: '5', visual: 'âš™ï¸', title: 'Improve Concepts', concept: 'Polish unpolished genres.', example: 'Lethal Company, Phasmophobia, Stardew Valley' },
            { id: '1-h6', deck: 1, suit: 'hearts', rank: '6', visual: 'ğŸ”„', title: 'Adapt Platform', concept: 'Transfer to new platforms.', example: 'Stumble Guys, Among Us VR, Wild Rift' },
            { id: '1-h7', deck: 1, suit: 'hearts', rank: '7', visual: 'ğŸ¤ª', title: 'Absurdity', concept: 'Combine the unexpected.', example: 'Palworld, Goat Simulator, Deer Simulator' },
            { id: '1-h8', deck: 1, suit: 'hearts', rank: '8', visual: 'ğŸ¥', title: 'Iconic Moments', concept: 'Famous scenes as gameplay.', example: 'SUPERHOT, Uncharted, Max Payne' },
            { id: '1-h9', deck: 1, suit: 'hearts', rank: '9', visual: 'ğŸ“º', title: 'Fake Ads', concept: 'Make fake ads real.', example: 'Project Makeover, Hero Wars, Last War' },
            { id: '1-h10', deck: 1, suit: 'hearts', rank: '10', visual: 'ğŸ°', title: 'History', concept: 'Rich cultural themes.', example: 'Kingdom Come, Assassin\'s Creed, Ghost of Tsushima' },
            { id: '1-hj', deck: 1, suit: 'hearts', rank: 'J', visual: 'â¤ï¸', title: 'Emotions', concept: 'Evoke specific feelings.', example: 'Journey, Spiritfarer, Before Your Eyes' },
            { id: '1-hq', deck: 1, suit: 'hearts', rank: 'Q', visual: 'ğŸ§©', title: '4th Wall', concept: 'Meta-narratives.', example: 'Stanley Parable, Doki Doki LC, Inscryption' },
            { id: '1-hk', deck: 1, suit: 'hearts', rank: 'K', visual: 'ğŸš€', title: 'New Tech', concept: 'Leverage emerging tech.', example: 'Beat Saber, Pokemon GO, Half-Life Alyx' },
            { id: '1-ha', deck: 1, suit: 'hearts', rank: 'A', visual: 'ğŸŒŸ', title: 'Fantasies', concept: 'Fulfill childhood dreams.', example: 'Sea of Thieves, PowerWash Sim, Sims 4' },
            
            { id: '1-s2', deck: 1, suit: 'spades', rank: '2', visual: 'ğŸ› ï¸', title: 'Game Mods', concept: 'Mods into standalone.', example: 'Dota 2, Counter-Strike, PUBG' },
            { id: '1-s3', deck: 1, suit: 'spades', rank: '3', visual: 'ğŸŒ', title: 'Real Life', concept: 'Everyday sensations.', example: 'Papers Please, Unpacking, Cooking Mama' },
            { id: '1-s4', deck: 1, suit: 'spades', rank: '4', visual: 'ğŸ”„', title: 'Inversion', concept: 'Flip the norm.', example: 'Choo-Choo Charles, Carrion, Reverse Horror' },
            { id: '1-s5', deck: 1, suit: 'spades', rank: '5', visual: 'ğŸ²', title: 'Tabletop', concept: 'Board games to digital.', example: 'Among Us (Mafia), Baldur\'s Gate 3, Hearthstone' },
            { id: '1-s6', deck: 1, suit: 'spades', rank: '6', visual: 'ğŸ”„', title: 'Role Reversal', concept: 'Control world, not hero.', example: 'Loop Hero, Dungeon Keeper, Plague Inc.' },
            { id: '1-s7', deck: 1, suit: 'spades', rank: '7', visual: 'â³', title: 'Game Jams', concept: 'Strict constraints.', example: 'Goat Simulator, Superhot, Baba Is You' },
            { id: '1-s8', deck: 1, suit: 'spades', rank: '8', visual: 'ğŸ”§', title: 'Reverse Engineer', concept: 'Fix genre frustrations.', example: 'Stardew Valley, Cities: Skylines, Planet Coaster' },
            { id: '1-s9', deck: 1, suit: 'spades', rank: '9', visual: 'ğŸ“–', title: 'Proc. Story', concept: 'Generated narrative arcs.', example: 'Wildermyth, Rimworld, Dwarf Fortress' },
            { id: '1-s10', deck: 1, suit: 'spades', rank: '10', visual: 'ğŸŒ', title: 'Physics Comedy', concept: 'Wobbly physics humor.', example: 'Human: Fall Flat, Gang Beasts, QWOP' },
            { id: '1-sj', deck: 1, suit: 'spades', rank: 'J', visual: 'ğŸµ', title: 'Rhythm Action', concept: 'Rhythm in non-music genres.', example: 'Crypt of NecroDancer, Metal Hellsinger, Hi-Fi Rush' },
            { id: '1-sq', deck: 1, suit: 'spades', rank: 'Q', visual: 'ğŸ­', title: 'Automation', concept: 'Complex engineering.', example: 'Factorio, Satisfactory, Mindustry' },
            { id: '1-sk', deck: 1, suit: 'spades', rank: 'K', visual: 'ğŸ–¼ï¸', title: 'Art Gameplay', concept: 'Visual medium as mechanic.', example: 'Gorogoa, Viewfinder, Chicory' },
            { id: '1-sa', deck: 1, suit: 'spades', rank: 'A', visual: 'ğŸ¦‡', title: 'Audio Nav', concept: 'See with sound.', example: 'Dark Echo, Blind Drive, The Vale' },
            
            { id: '1-d2', deck: 1, suit: 'diamonds', rank: '2', visual: 'âš–ï¸', title: 'Asymmetric', concept: 'Teams of different sizes.', example: 'Dead by Daylight, Evolve, Among Us' },
            { id: '1-d3', deck: 1, suit: 'diamonds', rank: '3', visual: 'â³', title: 'Time Control', concept: 'Rewind/Pause time.', example: 'Braid, Superhot, Prince of Persia' },
            { id: '1-d4', deck: 1, suit: 'diamonds', rank: '4', visual: 'ğŸ‘ï¸', title: 'Perspective', concept: 'Optical illusions.', example: 'Superliminal, Monument Valley, Fez' },
            { id: '1-d5', deck: 1, suit: 'diamonds', rank: '5', visual: 'ğŸ§ ', title: 'Knowledge', concept: 'Player levels up, not char.', example: 'Outer Wilds, Tunic, Return of Obra Dinn' },
            { id: '1-d6', deck: 1, suit: 'diamonds', rank: '6', visual: 'â„ï¸', title: 'Moral Survival', concept: 'Impossible ethical choices.', example: 'Frostpunk, This War of Mine, Papers Please' },
            { id: '1-d7', deck: 1, suit: 'diamonds', rank: '7', visual: 'ğŸ’€', title: 'High Lethality', concept: 'One-hit kills.', example: 'Hotline Miami, Ghostrunner, Katana Zero' },
            { id: '1-d8', deck: 1, suit: 'diamonds', rank: '8', visual: 'ğŸ§›', title: 'Reverse Bullet Hell', concept: 'You are the swarm.', example: 'Vampire Survivors, Brotato, 20 Minutes Till Dawn' },
            { id: '1-d9', deck: 1, suit: 'diamonds', rank: '9', visual: 'ğŸ’»', title: 'UI Narrative', concept: 'Game in an OS.', example: 'Hypnospace Outlaw, Emily is Away, Orwell' },
            { id: '1-d10', deck: 1, suit: 'diamonds', rank: '10', visual: 'ğŸ•°ï¸', title: 'Alt History', concept: 'Change one event.', example: 'Wolfenstein, Fallout, Atomic Heart' },
            { id: '1-dj', deck: 1, suit: 'diamonds', rank: 'J', visual: 'âš¡', title: 'Modern Myth', concept: 'Myths with modern vibes.', example: 'Hades, Percy Jackson, American Gods' },
            { id: '1-dq', deck: 1, suit: 'diamonds', rank: 'Q', visual: 'â˜•', title: 'Cozy', concept: 'Low stakes, high comfort.', example: 'Unpacking, Coffee Talk, A Short Hike' },
            { id: '1-dk', deck: 1, suit: 'diamonds', rank: 'K', visual: 'ğŸšª', title: 'Liminal Horror', concept: 'Empty, familiar spaces.', example: 'The Exit 8, Poolrooms, Superliminal' },
            { id: '1-da', deck: 1, suit: 'diamonds', rank: 'A', visual: 'âš½', title: 'Sports Hybrid', concept: 'Sport + Absurdity.', example: 'Rocket League, Golf Story, What the Golf?' },
            
            { id: '1-c2', deck: 1, suit: 'clubs', rank: '2', visual: 'ğŸ—£ï¸', title: 'Non-Violent', concept: 'Conflict via dialogue.', example: 'Disco Elysium, Undertale, Signs of the Sojourner' },
            { id: '1-c3', deck: 1, suit: 'clubs', rank: '3', visual: 'ğŸ ', title: 'Env. Narrative', concept: 'Story via objects.', example: 'Edith Finch, Gone Home, Bioshock' },
            { id: '1-c4', deck: 1, suit: 'clubs', rank: '4', visual: 'ğŸ§±', title: 'Destruction', concept: 'Breaking is solving.', example: 'Teardown, Red Faction, Besiege' },
            { id: '1-c5', deck: 1, suit: 'clubs', rank: '5', visual: 'ğŸ—ï¸', title: 'Construction', concept: 'Build tools to solve.', example: 'Besiege, Bridge Constructor, TotK' },
            { id: '1-c6', deck: 1, suit: 'clubs', rank: '6', visual: 'ğŸ“', title: 'Unfolding Idle', concept: 'Clicker reveals story.', example: 'Universal Paperclips, Candy Box, A Dark Room' },
            { id: '1-c7', deck: 1, suit: 'clubs', rank: '7', visual: 'ğŸ”´', title: 'Streamer API', concept: 'Chat affects game.', example: 'Cult of the Lamb, Twitch Plays Pokemon, Dead Cells' },
            { id: '1-c8', deck: 1, suit: 'clubs', rank: '8', visual: 'âŒ¨ï¸', title: 'Typing', concept: 'Typing as combat.', example: 'Typing of the Dead, Epistory, Textorcist' },
            { id: '1-c9', deck: 1, suit: 'clubs', rank: '9', visual: 'ğŸ¨', title: 'Color', concept: 'Matching colors mechanics.', example: 'Splatoon, Hue, Chicory' },
            { id: '1-c10', deck: 1, suit: 'clubs', rank: '10', visual: 'ğŸŒŒ', title: 'Gravity', concept: 'Change gravity direction.', example: 'Gravity Rush, Super Mario Galaxy, VVVVVV' },
            { id: '1-cj', deck: 1, suit: 'clubs', rank: 'J', visual: 'ğŸ–¥ï¸', title: 'Prog. Logic', concept: 'Write code to automate.', example: 'Baba Is You, Human Resource Machine, Screeps' },
            { id: '1-cq', deck: 1, suit: 'clubs', rank: 'Q', visual: 'ğŸ“¸', title: 'Photography', concept: 'Camera as weapon.', example: 'Pokemon Snap, Fatal Frame, Umurangi Generation' },
            { id: '1-ck', deck: 1, suit: 'clubs', rank: 'K', visual: 'ğŸœ', title: 'Living World', concept: 'World runs itself.', example: 'Dwarf Fortress, Rain World, Kenshi' },
            { id: '1-ca', deck: 1, suit: 'clubs', rank: 'A', visual: 'ğŸª¿', title: 'Stealth Comedy', concept: 'Mischief not murder.', example: 'Untitled Goose Game, Octodad, Goat Simulator' },
            
            { id: '1-joker', deck: 1, suit: 'joker', rank: 'â˜…', visual: 'ğŸï¸', title: 'Nostalgia', concept: 'Draw on beloved past media.', example: 'Cuphead, Shovel Knight, Sea of Stars' },
        ];

        const DECK_2 = [
            { id: '2-h2', deck: 2, suit: 'hearts', rank: '2', visual: 'ğŸ¤', title: 'Companion', concept: 'AI partner bond.', example: 'BioShock Infinite, Last of Us, God of War' },
            { id: '2-h3', deck: 2, suit: 'hearts', rank: '3', visual: 'âš”ï¸', title: 'Rival', concept: 'Recurring antagonist.', example: 'PokÃ©mon, Yakuza, Devil May Cry' },
            { id: '2-h4', deck: 2, suit: 'hearts', rank: '4', visual: 'ğŸ‘¥', title: 'Ensemble', concept: 'Group dynamics.', example: 'Mass Effect, Dragon Age, Persona 5' },
            { id: '2-h5', deck: 2, suit: 'hearts', rank: '5', visual: 'ğŸ¤¥', title: 'Unreliable', concept: 'Lying narrator.', example: 'Spec Ops: The Line, Bioshock, Silent Hill 2' },
            { id: '2-h6', deck: 2, suit: 'hearts', rank: '6', visual: 'â™¾ï¸', title: 'Time Loop', concept: 'Relive and learn.', example: '12 Minutes, Outer Wilds, Deathloop' },
            { id: '2-h7', deck: 2, suit: 'hearts', rank: '7', visual: 'ğŸ”', title: 'Whodunit', concept: 'Solve a crime.', example: 'Obra Dinn, Ace Attorney, Disco Elysium' },
            { id: '2-h8', deck: 2, suit: 'hearts', rank: '8', visual: 'ğŸ’˜', title: 'Romance', concept: 'Relationships.', example: 'Stardew Valley, Mass Effect, Hades' },
            { id: '2-h9', deck: 2, suit: 'hearts', rank: '9', visual: 'ğŸ­', title: 'Tragedy', concept: 'Loss and sacrifice.', example: 'Last of Us Part II, RDR2, Shadow of the Colossus' },
            { id: '2-h10', deck: 2, suit: 'hearts', rank: '10', visual: 'ğŸ¤¡', title: 'Satire', concept: 'Social commentary.', example: 'Helldivers 2, GTA V, Fallout' },
            { id: '2-hj', deck: 2, suit: 'hearts', rank: 'J', visual: 'ğŸ˜¶', title: 'Silent Hero', concept: 'Player projection.', example: 'Half-Life, Zelda, Portal' },
            { id: '2-hq', deck: 2, suit: 'hearts', rank: 'Q', visual: 'âš–ï¸', title: 'Moral Gray', concept: 'No good or evil.', example: 'Witcher 3, Cyberpunk 2077, Fallout New Vegas' },
            { id: '2-hk', deck: 2, suit: 'hearts', rank: 'K', visual: 'ğŸŒ²', title: 'Branching', concept: 'Massive variations.', example: 'Detroit: Become Human, Baldur\'s Gate 3, Until Dawn' },
            { id: '2-ha', deck: 2, suit: 'hearts', rank: 'A', visual: 'ğŸ¬', title: 'Director AI', concept: 'Dynamic pacing.', example: 'Left 4 Dead 2, Alien Isolation, Rimworld' },
            
            { id: '2-s2', deck: 2, suit: 'spades', rank: '2', visual: 'ğŸƒ', title: 'Deckbuilder', concept: 'Card-based combat.', example: 'Slay the Spire, Balatro, Marvel Snap' },
            { id: '2-s3', deck: 2, suit: 'spades', rank: '3', visual: 'ğŸš', title: 'Extraction', concept: 'High stakes escape.', example: 'Tarkov, Dark and Darker, Hunt: Showdown' },
            { id: '2-s4', deck: 2, suit: 'spades', rank: '4', visual: 'ğŸ›¡ï¸', title: 'Parry', concept: 'Defense is offense.', example: 'Sekiro, Lies of P, Street Fighter III' },
            { id: '2-s5', deck: 2, suit: 'spades', rank: '5', visual: 'ğŸ¥Š', title: 'Combo', concept: 'Chain attacks.', example: 'Devil May Cry, Bayonetta, Hi-Fi Rush' },
            { id: '2-s6', deck: 2, suit: 'spades', rank: '6', visual: 'ğŸª', title: 'Grapple', concept: 'Vertical mobility.', example: 'Spider-Man, Just Cause, Titanfall 2' },
            { id: '2-s7', deck: 2, suit: 'spades', rank: '7', visual: 'ğŸ¦–', title: 'Tamer', concept: 'Capture enemies.', example: 'Palworld, PokÃ©mon, Slime Rancher' },
            { id: '2-s8', deck: 2, suit: 'spades', rank: '8', visual: 'ğŸ‘»', title: 'Possession', concept: 'Control enemies.', example: 'Mario Odyssey, Driver San Francisco, Messiah' },
            { id: '2-s9', deck: 2, suit: 'spades', rank: '9', visual: 'ğŸ§Ÿ', title: 'Horde', concept: 'Overwhelming numbers.', example: 'Days Gone, Left 4 Dead, Vampire Survivors' },
            { id: '2-s10', deck: 2, suit: 'spades', rank: '10', visual: 'â±ï¸', title: 'Speedrun', concept: 'Optimization.', example: 'Neon White, Mirror\'s Edge, Sonic' },
            { id: '2-sj', deck: 2, suit: 'spades', rank: 'J', visual: 'ğŸ’°', title: 'Heist', concept: 'Plan and execute.', example: 'Payday 2, GTA V, Monaco' },
            { id: '2-sq', deck: 2, suit: 'spades', rank: 'Q', visual: 'ğŸ¤º', title: 'Duel', concept: '1v1 Spacing.', example: 'Nidhogg, For Honor, Bushido Blade' },
            { id: '2-sk', deck: 2, suit: 'spades', rank: 'K', visual: 'ğŸœ', title: 'Size Shift', concept: 'Scale mechanics.', example: 'Grounded, It Takes Two, Katamari' },
            { id: '2-sa', deck: 2, suit: 'spades', rank: 'A', visual: 'ğŸŒ‘', title: 'Shadow', concept: 'Light stealth.', example: 'Thief, Splinter Cell, Mark of the Ninja' },
            
            { id: '2-d2', deck: 2, suit: 'diamonds', rank: '2', visual: 'ğŸ”„', title: 'Roguelite', concept: 'Runs with upgrades.', example: 'Hades, Dead Cells, Binding of Isaac' },
            { id: '2-d3', deck: 2, suit: 'diamonds', rank: '3', visual: 'ğŸ°', title: 'Gacha', concept: 'Random rewards.', example: 'Genshin Impact, Fate/GO, Honkai Star Rail' },
            { id: '2-d4', deck: 2, suit: 'diamonds', rank: '4', visual: 'ğŸ“ˆ', title: 'Prestige', concept: 'Reset for power.', example: 'Cookie Clicker, Adventure Capitalist, Idle Miner' },
            { id: '2-d5', deck: 2, suit: 'diamonds', rank: '5', visual: 'â›ï¸', title: 'Crafting', concept: 'Gather > Craft.', example: 'Minecraft, Terraria, Valheim' },
            { id: '2-d6', deck: 2, suit: 'diamonds', rank: '6', visual: 'ğŸ’¹', title: 'Player Market', concept: 'Trading economy.', example: 'EVE Online, WoW, Warframe' },
            { id: '2-d7', deck: 2, suit: 'diamonds', rank: '7', visual: 'ğŸ¦‹', title: 'Collection', concept: 'Fill the museum.', example: 'Animal Crossing, PokÃ©mon, Stardew Valley' },
            { id: '2-d8', deck: 2, suit: 'diamonds', rank: '8', visual: 'ğŸŸï¸', title: 'Battle Pass', concept: 'Seasonal tracks.', example: 'Fortnite, Apex Legends, COD Warzone' },
            { id: '2-d9', deck: 2, suit: 'diamonds', rank: '9', visual: 'âœï¸', title: 'Level Editor', concept: 'UGC Tools.', example: 'Mario Maker, LittleBigPlanet, Roblox' },
            { id: '2-d10', deck: 2, suit: 'diamonds', rank: '10', visual: 'ğŸ“œ', title: 'Wiki-Bait', concept: 'Obscure lore.', example: 'Tunic, Elden Ring, Fez' },
            { id: '2-dj', deck: 2, suit: 'diamonds', rank: 'J', visual: 'ğŸ“Š', title: 'Min-Max', concept: 'Deep stats.', example: 'Path of Exile, Diablo IV, Monster Hunter' },
            { id: '2-dq', deck: 2, suit: 'diamonds', rank: 'Q', visual: 'ğŸ“…', title: 'Daily', concept: 'One challenge/day.', example: 'Wordle, Daily Runs, Animal Crossing' },
            { id: '2-dk', deck: 2, suit: 'diamonds', rank: 'K', visual: 'ğŸ“º', title: 'Episodic', concept: 'Released chapters.', example: 'Walking Dead, Life is Strange, Deltarune' },
            { id: '2-da', deck: 2, suit: 'diamonds', rank: 'A', visual: 'ğŸ•µï¸', title: 'ARG', concept: 'Reality blending.', example: 'Inscryption, Doki Doki LC, Frog Fractions' },
            
            { id: '2-c2', deck: 2, suit: 'clubs', rank: '2', visual: 'ğŸ”¥', title: 'Element', concept: 'Chemistry systems.', example: 'Breath of the Wild, Magicka, Divinity OS2' },
            { id: '2-c3', deck: 2, suit: 'clubs', rank: '3', visual: 'ğŸ‘½', title: 'Stalker AI', concept: 'Hunting enemy.', example: 'Alien: Isolation, Resident Evil 2, Mr. X' },
            { id: '2-c4', deck: 2, suit: 'clubs', rank: '4', visual: 'ğŸ•³ï¸', title: 'Deformable', concept: 'Digging terrain.', example: 'Deep Rock Galactic, Red Faction, Minecraft' },
            { id: '2-c5', deck: 2, suit: 'clubs', rank: '5', visual: 'ğŸŒŠ', title: 'Fluid', concept: 'Liquid physics.', example: 'Mario Sunshine, Splatoon, From Dust' },
            { id: '2-c6', deck: 2, suit: 'clubs', rank: '6', visual: 'ğŸŒ€', title: 'Portal', concept: 'Non-Euclidean.', example: 'Portal, Antichamber, Superliminal' },
            { id: '2-c7', deck: 2, suit: 'clubs', rank: '7', visual: 'ğŸŒ—', title: 'Dual World', concept: 'Dimension swap.', example: 'Titanfall 2, Lords of the Fallen, Link to the Past' },
            { id: '2-c8', deck: 2, suit: 'clubs', rank: '8', visual: 'ğŸš›', title: 'Vehicle Sim', concept: 'Driving physics.', example: 'SnowRunner, Euro Truck Sim, BeamNG' },
            { id: '2-c9', deck: 2, suit: 'clubs', rank: '9', visual: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', title: 'Crowd', concept: 'Social stealth.', example: 'Hitman, Assassin\'s Creed, Party Hard' },
            { id: '2-c10', deck: 2, suit: 'clubs', rank: '10', visual: 'ğŸš—', title: 'Soft Body', concept: 'Realistic crash.', example: 'BeamNG.drive, Wreckfest, FlatOut' },
            { id: '2-cj', deck: 2, suit: 'clubs', rank: 'J', visual: 'ğŸ¤', title: 'Voice', concept: 'Mic input.', example: 'Lethal Company, Phasmophobia, Seaman' },
            { id: '2-cq', deck: 2, suit: 'clubs', rank: 'Q', visual: 'ğŸ“', title: 'GPS', concept: 'Location based.', example: 'Pokemon GO, Monster Hunter Now, Orna' },
            { id: '2-ck', deck: 2, suit: 'clubs', rank: 'K', visual: 'ğŸ§¬', title: 'Evolution', concept: 'Procedural life.', example: 'Spore, No Man\'s Sky, Ancestors' },
            { id: '2-ca', deck: 2, suit: 'clubs', rank: 'A', visual: 'ğŸŒªï¸', title: 'Weather', concept: 'Dynamic storms.', example: 'Sea of Thieves, Mad Max, Just Cause 4' },
            
            { id: '2-joker', deck: 2, suit: 'joker', rank: 'â˜…', visual: 'ğŸ“€', title: 'Remaster', concept: 'Modernize classic.', example: 'Resident Evil 4, FF7 Remake, Dead Space' },
        ];

        const DECK_3 = [
            { id: '3-h2', deck: 3, suit: 'hearts', rank: '2', visual: 'ğŸ‘¾', title: 'Pixel Art', concept: 'Retro nostalgia or modern crunch.', example: 'Celeste, Stardew Valley, Terraria' },
            { id: '3-h3', deck: 3, suit: 'hearts', rank: '3', visual: 'ğŸ”³', title: 'Low Poly', concept: 'PS1 era aesthetics.', example: 'Ultrakill, Deep Rock Galactic, Valheim' },
            { id: '3-h4', deck: 3, suit: 'hearts', rank: '4', visual: 'ğŸ–Œï¸', title: 'Cel Shaded', concept: 'Living comic book.', example: 'Borderlands, Zelda: Wind Waker, Hi-Fi Rush' },
            { id: '3-h5', deck: 3, suit: 'hearts', rank: '5', visual: 'ğŸŒš', title: 'Noir', concept: 'High contrast black & white.', example: 'Limbo, Return of the Obra Dinn, Trek to Yomi' },
            { id: '3-h6', deck: 3, suit: 'hearts', rank: '6', visual: 'ğŸ¨', title: 'Hand-Drawn', concept: 'Traditional animation frames.', example: 'Cuphead, Hollow Knight, Spiritfarer' },
            { id: '3-h7', deck: 3, suit: 'hearts', rank: '7', visual: 'ğŸŒˆ', title: 'Psychedelic', concept: 'Sensory overload colors.', example: 'Hotline Miami, Cruelty Squad, Rez' },
            { id: '3-h8', deck: 3, suit: 'hearts', rank: '8', visual: 'ğŸ§±', title: 'Voxel', concept: '3D Pixel blocks.', example: 'Minecraft, Teardown, Cube World' },
            { id: '3-h9', deck: 3, suit: 'hearts', rank: '9', visual: 'ğŸ©¸', title: 'Gothic', concept: 'Dark, ornate, imposing.', example: 'Bloodborne, Darkest Dungeon, Castlevania' },
            { id: '3-h10', deck: 3, suit: 'hearts', rank: '10', visual: 'â¬œ', title: 'Minimalism', concept: 'Clean lines, flat colors.', example: 'Mini Metro, Superhot, Thomas Was Alone' },
            { id: '3-hj', deck: 3, suit: 'hearts', rank: 'J', visual: 'ğŸ–¼ï¸', title: 'Watercolor', concept: 'Soft, painted edges.', example: 'Gris, Okami, Dorf Romantik' },
            { id: '3-hq', deck: 3, suit: 'hearts', rank: 'Q', visual: 'ğŸ“º', title: 'CRT Filter', concept: 'Analog signal decay.', example: 'Signalis, Balatro, Alien Isolation' },
            { id: '3-hk', deck: 3, suit: 'hearts', rank: 'K', visual: 'ğŸ—¿', title: 'Claymation', concept: 'Stop-motion aesthetic.', example: 'Hylics, The Neverhood, Harold Halibut' },
            { id: '3-ha', deck: 3, suit: 'hearts', rank: 'A', visual: 'ğŸ“·', title: 'Photoreal', concept: 'Uncanny realism.', example: 'Unrecord, Hellblade II, RDR2' },

            { id: '3-s2', deck: 3, suit: 'spades', rank: '2', visual: 'ğŸ¹', title: 'Dynamic Music', concept: 'Music changes with action.', example: 'Doom Eternal, Metal Hellsinger, Nier Automata' },
            { id: '3-s3', deck: 3, suit: 'spades', rank: '3', visual: 'ğŸ”‡', title: 'Silence', concept: 'Absence of sound for tension.', example: 'Inside, Dark Souls, Shadow of Colossus' },
            { id: '3-s4', deck: 3, suit: 'spades', rank: '4', visual: 'ğŸ‘¾', title: 'Chiptune', concept: '8-bit constraints.', example: 'Shovel Knight, Undertale, Celeste' },
            { id: '3-s5', deck: 3, suit: 'spades', rank: '5', visual: 'ğŸ»', title: 'Orchestral', concept: 'Epic cinematic score.', example: 'Elden Ring, Final Fantasy, Halo' },
            { id: '3-s6', deck: 3, suit: 'spades', rank: '6', visual: 'ğŸ§', title: 'Binaural 3D', concept: 'Positional audio focus.', example: 'Hellblade, Hunt: Showdown, Overwatch' },
            { id: '3-s7', deck: 3, suit: 'spades', rank: '7', visual: 'ğŸ”Š', title: 'Diegetic', concept: 'Sound comes from in-world.', example: 'Dead Space, Alien Isolation, Metro Exodus' },
            { id: '3-s8', deck: 3, suit: 'spades', rank: '8', visual: 'ğŸ—£ï¸', title: 'Narrator', concept: 'Voiceover reacts to play.', example: 'Bastion, Stanley Parable, Baldur\'s Gate 3' },
            { id: '3-s9', deck: 3, suit: 'spades', rank: '9', visual: 'ğŸ¥', title: 'Rhythm Sync', concept: 'SFX match the beat.', example: 'Hi-Fi Rush, Rez, Thumper' },
            { id: '3-s10', deck: 3, suit: 'spades', rank: '10', visual: 'ğŸ¤«', title: 'ASMR', concept: 'Satisfying clicks/whispers.', example: 'Unpacking, Potion Craft, Dorfromantik' },
            { id: '3-sj', deck: 3, suit: 'spades', rank: 'J', visual: 'ğŸ­', title: 'Industrial', concept: 'Grinding metal sounds.', example: 'Factorio, Silent Hill, Scorn' },
            { id: '3-sq', deck: 3, suit: 'spades', rank: 'Q', visual: 'ğŸ¦—', title: 'Ambient', concept: 'Nature and atmosphere.', example: 'Breath of the Wild, Skyrim, Flower' },
            { id: '3-sk', deck: 3, suit: 'spades', rank: 'K', visual: 'ğŸ’¥', title: 'Glitch', concept: 'Audio artifacts/distortion.', example: 'Cyberpunk 2077, Pony Island, Axiom Verge' },
            { id: '3-sa', deck: 3, suit: 'spades', rank: 'A', visual: 'ğŸ¸', title: 'Adaptive', concept: 'Instru. layers add up.', example: 'Nier Automata, Hades, Red Dead Redemption' },

            { id: '3-d2', deck: 3, suit: 'diamonds', rank: '2', visual: 'ğŸ‘€', title: 'First Person', concept: 'Through the eyes.', example: 'Call of Duty, Portal, Cyberpunk 2077' },
            { id: '3-d3', deck: 3, suit: 'diamonds', rank: '3', visual: 'ğŸ“', title: 'Isometric', concept: '3/4 top-down view.', example: 'Hades, Disco Elysium, Diablo' },
            { id: '3-d4', deck: 3, suit: 'diamonds', rank: '4', visual: 'ğŸƒ', title: 'Side Scroller', concept: '2D plane movement.', example: 'Mario, Hollow Knight, Limbo' },
            { id: '3-d5', deck: 3, suit: 'diamonds', rank: '5', visual: 'ğŸš', title: 'Top-Down', concept: 'Bird\'s eye view.', example: 'Hotline Miami, Factorio, GTA 2' },
            { id: '3-d6', deck: 3, suit: 'diamonds', rank: '6', visual: 'ğŸ¥', title: 'Fixed Angle', concept: 'Cinematic specific frames.', example: 'Resident Evil 1, God of War 3, Until Dawn' },
            { id: '3-d7', deck: 3, suit: 'diamonds', rank: '7', visual: 'ğŸ¥½', title: 'VR', concept: 'Headset immersion.', example: 'Half-Life Alyx, Beat Saber, Superhot VR' },
            { id: '3-d8', deck: 3, suit: 'diamonds', rank: '8', visual: 'ğŸ–¥ï¸', title: 'Second Person', concept: 'Watching a screen in-game.', example: 'Five Nights at Freddy\'s, Duskers, Observation' },
            { id: '3-d9', deck: 3, suit: 'diamonds', rank: '9', visual: 'ğŸ“œ', title: 'Text-Only', concept: 'Imagination driven.', example: 'Zork, A Dark Room, AI Dungeon' },
            { id: '3-d10', deck: 3, suit: 'diamonds', rank: '10', visual: 'ğŸªŸ', title: 'Split Screen', concept: 'Simultaneous views.', example: 'It Takes Two, The Medium, Mario Kart' },
            { id: '3-dj', deck: 3, suit: 'diamonds', rank: 'J', visual: 'ğŸš«', title: 'UI-less', concept: 'Zero HUD immersion.', example: 'Dead Space, Journey, Firewatch' },
            { id: '3-dq', deck: 3, suit: 'diamonds', rank: 'Q', visual: 'ğŸ“¹', title: 'CCTV/Bodycam', concept: 'Grainy surveillance lens.', example: 'Observation, Content Warning, FNAF' },
            { id: '3-dk', deck: 3, suit: 'diamonds', rank: 'K', visual: 'ğŸŸ', title: 'Fish-eye', concept: 'Distorted wide angle.', example: 'Cruelty Squad, Skate, Ultra-Wide' },
            { id: '3-da', deck: 3, suit: 'diamonds', rank: 'A', visual: 'ğŸ“±', title: 'Portrait', concept: 'Vertical phone view.', example: 'Clash Royale, Downwell, Marvel Snap' },

            { id: '3-c2', deck: 3, suit: 'clubs', rank: '2', visual: 'â˜•', title: 'Cozy', concept: 'Safe and warm.', example: 'Stardew Valley, Animal Crossing, Unpacking' },
            { id: '3-c3', deck: 3, suit: 'clubs', rank: '3', visual: 'ğŸ˜±', title: 'Horror', concept: 'Dread and panic.', example: 'Amnesia, Outlast, Resident Evil' },
            { id: '3-c4', deck: 3, suit: 'clubs', rank: '4', visual: 'âš¡', title: 'Adrenaline', concept: 'High speed focus.', example: 'Doom, Burnout, Hotline Miami' },
            { id: '3-c5', deck: 3, suit: 'clubs', rank: '5', visual: 'ğŸ§˜', title: 'Zen', concept: 'Flow state relaxation.', example: 'Tetris Effect, Flow, Journey' },
            { id: '3-c6', deck: 3, suit: 'clubs', rank: '6', visual: 'ğŸ˜¢', title: 'Melancholy', concept: 'Sad but beautiful.', example: 'Gris, Shadow of the Colossus, Spiritfarer' },
            { id: '3-c7', deck: 3, suit: 'clubs', rank: '7', visual: 'ğŸŒ', title: 'Slapstick', concept: 'Goofy physicality.', example: 'Fall Guys, Goat Simulator, Human Fall Flat' },
            { id: '3-c8', deck: 3, suit: 'clubs', rank: '8', visual: 'ğŸ°', title: 'Epic', concept: 'Grand scale grandeur.', example: 'Elden Ring, God of War, Halo' },
            { id: '3-c9', deck: 3, suit: 'clubs', rank: '9', visual: 'ğŸ“¦', title: 'Claustrophobic', concept: 'Tight, oppressive spaces.', example: 'Iron Lung, Metroid, Dead Space' },
            { id: '3-c10', deck: 3, suit: 'clubs', rank: '10', visual: 'ğŸï¸', title: 'Nostalgic', concept: 'Yearning for the past.', example: 'Shovel Knight, Stranger Things, Thimbleweed Park' },
            { id: '3-cj', deck: 3, suit: 'clubs', rank: 'J', visual: 'ğŸ„', title: 'Surreal', concept: 'Dream logic weirdness.', example: 'Superliminal, Antichamber, Control' },
            { id: '3-cq', deck: 3, suit: 'clubs', rank: 'Q', visual: 'ğŸª¨', title: 'Gritty', concept: 'Dirty realism.', example: 'Last of Us, Gears of War, Metro' },
            { id: '3-ck', deck: 3, suit: 'clubs', rank: 'K', visual: 'ğŸ ', title: 'Whimsical', concept: 'Playful imagination.', example: 'LittleBigPlanet, Psychonauts, Katamari' },
            { id: '3-ca', deck: 3, suit: 'clubs', rank: 'A', visual: 'âœ¨', title: 'Ethereal', concept: 'Otherworldly divine.', example: 'Journey, Child of Light, Sky: Children of Light' },

            { id: '3-joker', deck: 3, suit: 'joker', rank: 'â˜…', visual: 'ğŸ¤¡', title: 'Mascot', concept: 'Character-driven brand.', example: 'Mario, Sonic, Crash Bandicoot' },
        ];

        const DECK_4 = [
            { id: '4-h2', deck: 4, suit: 'hearts', rank: '2', visual: 'â˜ï¸', title: 'Floating Isles', concept: 'Sky world archipelagos.', example: 'BioShock Infinite, Zelda: TotK, Skies of Arcadia' },
            { id: '4-h3', deck: 4, suit: 'hearts', rank: '3', visual: 'ğŸŒ†', title: 'Cyber City', concept: 'Neon rain metropolis.', example: 'Cyberpunk 2077, Stray, Cloudpunk' },
            { id: '4-h4', deck: 4, suit: 'hearts', rank: '4', visual: 'â˜¢ï¸', title: 'Post-Apoc', concept: 'Ruined civilization.', example: 'Fallout, Last of Us, Horizon Zero Dawn' },
            { id: '4-h5', deck: 4, suit: 'hearts', rank: '5', visual: 'ğŸ¦‘', title: 'Deep Sea', concept: 'Underwater pressure.', example: 'Subnautica, Dave the Diver, BioShock' },
            { id: '4-h6', deck: 4, suit: 'hearts', rank: '6', visual: 'ğŸ›°ï¸', title: 'Space Station', concept: 'Technological isolation.', example: 'Prey, Among Us, Dead Space' },
            { id: '4-h7', deck: 4, suit: 'hearts', rank: '7', visual: 'ğŸ•³ï¸', title: 'Subterranean', concept: 'Underground networks.', example: 'Hollow Knight, Metro, Core Keeper' },
            { id: '4-h8', deck: 4, suit: 'hearts', rank: '8', visual: 'ğŸŒŒ', title: 'Infinite Void', concept: 'Empty space/nothingness.', example: 'Outer Wilds, No Man\'s Sky, Elite Dangerous' },
            { id: '4-h9', deck: 4, suit: 'hearts', rank: '9', visual: 'ğŸŒ³', title: 'Living Forest', concept: 'Nature is sentient.', example: 'Ori, Darkwood, Avatar' },
            { id: '4-h10', deck: 4, suit: 'hearts', rank: '10', visual: 'ğŸœï¸', title: 'Wasteland', concept: 'Harsh desert survival.', example: 'Mad Max, Journey, Dune' },
            { id: '4-hj', deck: 4, suit: 'hearts', rank: 'J', visual: 'âš™ï¸', title: 'Clockwork', concept: 'Inside a giant machine.', example: 'Dishonored 2, Machinarium, Syberia' },
            { id: '4-hq', deck: 4, suit: 'hearts', rank: 'Q', visual: 'ğŸ¬', title: 'Candy Land', concept: 'Edible landscape.', example: 'Cuphead, Fall Guys, Wreck-It Ralph' },
            { id: '4-hk', deck: 4, suit: 'hearts', rank: 'K', visual: 'ğŸ’¤', title: 'Dreamscape', concept: 'Logic-defying mind.', example: 'Psychonauts, Omori, Yume Nikki' },
            { id: '4-ha', deck: 4, suit: 'hearts', rank: 'A', visual: 'ğŸ‘¾', title: 'Glitch World', concept: 'Code is breaking down.', example: 'Axiom Verge, Pony Island, Matrix' },

            { id: '4-s2', deck: 4, suit: 'spades', rank: '2', visual: 'ğŸš‚', title: 'Steampunk', concept: 'Brass and steam.', example: 'BioShock, Frostpunk, The Order 1886' },
            { id: '4-s3', deck: 4, suit: 'spades', rank: '3', visual: 'ğŸ¦´', title: 'Stone Age', concept: 'Primal survival.', example: 'Far Cry Primal, Turok, Ancestors' },
            { id: '4-s4', deck: 4, suit: 'spades', rank: '4', visual: 'ğŸš€', title: 'Far Future', concept: 'Type III civilization.', example: 'Halo, Mass Effect, Destiny' },
            { id: '4-s5', deck: 4, suit: 'spades', rank: '5', visual: 'ğŸ“¼', title: '1980s', concept: 'Neon retro nostalgia.', example: 'Hotline Miami, GTA Vice City, Yakuza 0' },
            { id: '4-s6', deck: 4, suit: 'spades', rank: '6', visual: 'ğŸ°', title: 'Medieval', concept: 'Swords and castles.', example: 'Witcher, Skyrim, Kingdom Come' },
            { id: '4-s7', deck: 4, suit: 'spades', rank: '7', visual: 'ğŸ¯', title: 'Feudal Japan', concept: 'Samurai and mythology.', example: 'Sekiro, Ghost of Tsushima, Nioh' },
            { id: '4-s8', deck: 4, suit: 'spades', rank: '8', visual: 'ğŸ¤ ', title: 'Wild West', concept: 'Outlaws and frontiers.', example: 'Red Dead, Weird West, Call of Juarez' },
            { id: '4-s9', deck: 4, suit: 'spades', rank: '9', visual: 'ğŸ•µï¸', title: 'Cold War', concept: 'Espionage and tension.', example: 'MGS 3, CoD Black Ops, Atomic Heart' },
            { id: '4-s10', deck: 4, suit: 'spades', rank: '10', visual: 'â˜€ï¸', title: 'Solar Punk', concept: 'Green utopia technology.', example: 'Terra Nil, Overwatch, Mirror\'s Edge' },
            { id: '4-sj', deck: 4, suit: 'spades', rank: 'J', visual: 'â›½', title: 'Dieselpunk', concept: 'Gritty combustion tech.', example: 'Wolfenstein, FF7 Midgar, Iron Harvest' },
            { id: '4-sq', deck: 4, suit: 'spades', rank: 'Q', visual: 'ğŸº', title: 'Mythic Age', concept: 'Gods walk the earth.', example: 'God of War, Age of Mythology, Hades' },
            { id: '4-sk', deck: 4, suit: 'spades', rank: 'K', visual: 'ğŸ©', title: 'Victorian', concept: 'Gaslight and cobblestone.', example: 'Bloodborne, Sherlock Holmes, Assassin\'s Creed Syndicate' },
            { id: '4-sa', deck: 4, suit: 'spades', rank: 'A', visual: 'ğŸ§ ', title: 'Singularity', concept: 'AI transcendence.', example: 'System Shock, SOMA, Detroit: Become Human' },

            { id: '4-d2', deck: 4, suit: 'diamonds', rank: '2', visual: 'ğŸ§ ', title: 'Hive Mind', concept: 'One shared consciousness.', example: 'The Flood (Halo), Tyranids, Zerg' },
            { id: '4-d3', deck: 4, suit: 'diamonds', rank: '3', visual: 'ğŸ¢', title: 'Megacorp', concept: 'Profit over people.', example: 'Arasaka (Cyberpunk), Shinra, Umbrella Corp' },
            { id: '4-d4', deck: 4, suit: 'diamonds', rank: '4', visual: 'ğŸ•¯ï¸', title: 'The Cult', concept: 'Fanatical devotion.', example: 'Far Cry 5, Resident Evil 4, Silent Hill' },
            { id: '4-d5', deck: 4, suit: 'diamonds', rank: '5', visual: 'âœŠ', title: 'Resistance', concept: 'Underdogs fighting back.', example: 'XCOM, Half-Life 2, Star Wars' },
            { id: '4-d6', deck: 4, suit: 'diamonds', rank: '6', visual: 'ğŸ¤–', title: 'AI Gods', concept: 'Machines rule man.', example: 'Matrix, Horizon Zero Dawn, I Have No Mouth' },
            { id: '4-d7', deck: 4, suit: 'diamonds', rank: '7', visual: 'ğŸª“', title: 'Barbarians', concept: 'Chaos and strength.', example: 'Mad Max, Warhammer Orks, Conan' },
            { id: '4-d8', deck: 4, suit: 'diamonds', rank: '8', visual: 'ğŸ“', title: 'Academy', concept: 'Knowledge seekers.', example: 'Hogwarts, Fire Emblem, Persona' },
            { id: '4-d9', deck: 4, suit: 'diamonds', rank: '9', visual: 'ğŸ“œ', title: 'The Guild', concept: 'Professional network.', example: 'Skyrim Thieves, Monster Hunter, Witcher' },
            { id: '4-d10', deck: 4, suit: 'diamonds', rank: '10', visual: 'ğŸ‘‘', title: 'The Royals', concept: 'Decadent rulers.', example: 'Dishonored, Fable, Crusader Kings' },
            { id: '4-dj', deck: 4, suit: 'diamonds', rank: 'J', visual: 'ğŸ’°', title: 'Bandits', concept: 'Lawless opportunists.', example: 'Borderlands, Fallout Raiders, Rust' },
            { id: '4-dq', deck: 4, suit: 'diamonds', rank: 'Q', visual: 'ğŸ›ï¸', title: 'Ancients', concept: 'Precursor civilization.', example: 'Forerunners, Protheans, Zonai' },
            { id: '4-dk', deck: 4, suit: 'diamonds', rank: 'K', visual: 'ğŸ§¬', title: 'Mutants', concept: 'Biologically altered.', example: 'X-Men, Fallout Ghouls, TMNT' },
            { id: '4-da', deck: 4, suit: 'diamonds', rank: 'A', visual: 'ğŸ¦¾', title: 'Cyborgs', concept: 'Man machine hybrids.', example: 'Deus Ex, Cyberpunk, Robocop' },

            { id: '4-c2', deck: 4, suit: 'clubs', rank: '2', visual: 'ğŸ“œ', title: 'Prophecy', concept: 'Chosen one destiny.', example: 'Zelda, Morrowind, Harry Potter' },
            { id: '4-c3', deck: 4, suit: 'clubs', rank: '3', visual: 'ğŸ’', title: 'The Heist', concept: 'Steal the object.', example: 'GTA V, Payday, Sly Cooper' },
            { id: '4-c4', deck: 4, suit: 'clubs', rank: '4', visual: 'ğŸƒ', title: 'The Escape', concept: 'Get out alive.', example: 'Portal, Hades, A Way Out' },
            { id: '4-c5', deck: 4, suit: 'clubs', rank: '5', visual: 'ğŸ˜¡', title: 'Revenge', concept: 'Avenge the fallen.', example: 'God of War, Last of Us 2, Sifu' },
            { id: '4-c6', deck: 4, suit: 'clubs', rank: '6', visual: 'ğŸ•µï¸', title: 'Mystery', concept: 'Find the truth.', example: 'Outer Wilds, Her Story, Heavy Rain' },
            { id: '4-c7', deck: 4, suit: 'clubs', rank: '7', visual: 'ğŸ†', title: 'Tournament', concept: 'Prove you are best.', example: 'Mortal Kombat, Unreal, Apex Legends' },
            { id: '4-c8', deck: 4, suit: 'clubs', rank: '8', visual: 'ğŸš©', title: 'Colonization', concept: 'Tame the wild.', example: 'Factorio, Rimworld, Civ' },
            { id: '4-c9', deck: 4, suit: 'clubs', rank: '9', visual: 'â›º', title: 'Survival', concept: 'Endure the elements.', example: 'The Long Dark, Don\'t Starve, Green Hell' },
            { id: '4-c10', deck: 4, suit: 'clubs', rank: '10', visual: 'âš”ï¸', title: 'The War', concept: 'Turn the tide.', example: 'Call of Duty, Helldivers, Foxhole' },
            { id: '4-cj', deck: 4, suit: 'clubs', rank: 'J', visual: 'ğŸ§­', title: 'Discovery', concept: 'Map the unknown.', example: 'No Man\'s Sky, Subnautica, Minecraft' },
            { id: '4-cq', deck: 4, suit: 'clubs', rank: 'Q', visual: 'ğŸ¦ ', title: 'Corruption', concept: 'Stop the spread.', example: 'Terraria, Horizon, The Last of Us' },
            { id: '4-ck', deck: 4, suit: 'clubs', rank: 'K', visual: 'ğŸ”', title: 'The Loop', concept: 'Break the cycle.', example: 'Deathloop, Returnal, Majora\'s Mask' },
            { id: '4-ca', deck: 4, suit: 'clubs', rank: 'A', visual: 'ğŸ•¯ï¸', title: 'Sacrifice', concept: 'Give up everything.', example: 'Dark Souls, Hellblade, Life is Strange' },

            { id: '4-joker', deck: 4, suit: 'joker', rank: 'â˜…', visual: 'ğŸŒ', title: 'Open World', concept: 'Go anywhere.', example: 'Breath of the Wild, Elden Ring, Skyrim' },
        ];

        // --- App Logic ---
        const app = {
            state: {
                activeDecks: { 1: true, 2: false, 3: false, 4: false },
                currentDeck: [],
                drawIndex: 0,
                keptCards: [],
                burnedCardIds: [], // IDs of cards removed from deck
                view: 'draw',
                animating: false,
                mobileMenuOpen: false
            },

            init() {
                const loaded = this.loadState();
                
                if (!loaded) {
                    this.shuffleDecks();
                } else {
                    // Ensure burned cards are removed from restored currentDeck
                    if (this.state.burnedCardIds.length > 0) {
                        this.state.currentDeck = this.state.currentDeck.filter(c => !this.state.burnedCardIds.includes(c.id));
                        if(this.state.currentDeck.length === 0) this.shuffleDecks();
                    }
                }
                
                this.render();
                this.setupGestures();
            },

            // --- Persistence Logic ---
            saveState() {
                try {
                    const stateToSave = {
                        activeDecks: this.state.activeDecks,
                        currentDeckIds: this.state.currentDeck.map(c => c.id),
                        drawIndex: this.state.drawIndex,
                        keptCardIds: this.state.keptCards.map(c => c.id),
                        burnedCardIds: this.state.burnedCardIds
                    };
                    localStorage.setItem('gamedeck_state_v2', JSON.stringify(stateToSave));
                } catch (e) {
                    console.error("Save failed", e);
                }
            },

            loadState() {
                const json = localStorage.getItem('gamedeck_state_v2');
                if(!json) return false;
                
                try {
                    const saved = JSON.parse(json);
                    
                    const allCards = [...DECK_1, ...DECK_2, ...DECK_3, ...DECK_4];
                    const cardMap = allCards.reduce((acc, c) => { acc[c.id] = c; return acc; }, {});

                    this.state.activeDecks = saved.activeDecks || { 1: true, 2: false, 3: false, 4: false };
                    this.state.drawIndex = saved.drawIndex || 0;
                    this.state.burnedCardIds = saved.burnedCardIds || [];
                    
                    if (saved.currentDeckIds && saved.currentDeckIds.length > 0) {
                        this.state.currentDeck = saved.currentDeckIds
                            .map(id => cardMap[id])
                            .filter(Boolean);
                    } else {
                        return false; 
                    }
                    
                    if (saved.keptCardIds) {
                        this.state.keptCards = saved.keptCardIds
                            .map(id => cardMap[id])
                            .filter(Boolean);
                    }

                    return true;
                } catch(e) {
                    console.error("Load failed", e);
                    return false;
                }
            },

            toggleMobileMenu() {
                this.state.mobileMenuOpen = !this.state.mobileMenuOpen;
                this.render();
            },

            shuffleDecks(animate = false) {
                let combined = [];
                if (this.state.activeDecks[1]) combined = [...combined, ...DECK_1];
                if (this.state.activeDecks[2]) combined = [...combined, ...DECK_2];
                if (this.state.activeDecks[3]) combined = [...combined, ...DECK_3];
                if (this.state.activeDecks[4]) combined = [...combined, ...DECK_4];
                
                if(combined.length === 0) {
                    combined = [...DECK_1]; 
                    this.state.activeDecks[1] = true;
                }

                // Filter out burned cards
                combined = combined.filter(c => !this.state.burnedCardIds.includes(c.id));
                
                // If all cards are burned/gone, restore them to prevent empty deck crash? 
                // Or just show empty state? For now, let's assume users won't burn 200 cards.
                // If they do, let's just restore everything for safety.
                if (combined.length === 0) {
                    this.state.burnedCardIds = [];
                    // Re-fetch source
                    if (this.state.activeDecks[1]) combined = [...combined, ...DECK_1];
                    if (this.state.activeDecks[2]) combined = [...combined, ...DECK_2];
                    if (this.state.activeDecks[3]) combined = [...combined, ...DECK_3];
                    if (this.state.activeDecks[4]) combined = [...combined, ...DECK_4];
                }

                // Fisher-Yates shuffle
                for (let i = combined.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [combined[i], combined[j]] = [combined[j], combined[i]];
                }
                
                this.state.currentDeck = combined;
                this.state.drawIndex = 0;
                this.saveState();
            },

            toggleDeck(id) {
                const newActive = { ...this.state.activeDecks, [id]: !this.state.activeDecks[id] };
                const hasActive = Object.values(newActive).some(val => val === true);
                if (!hasActive) return;

                this.state.activeDecks = newActive;
                this.shuffleDecks(); 
                this.render();
            },

            setView(viewName) {
                this.state.view = viewName;
                this.state.mobileMenuOpen = false;
                this.render();
            },

            // --- Actions ---

            discard() {
                if (this.state.animating) return;
                const cardEl = document.getElementById('card-wrapper').firstElementChild;
                if (cardEl) {
                    cardEl.classList.add('card-discard-left');
                    this.state.animating = true;
                    setTimeout(() => {
                        this.advanceDeck();
                    }, 300);
                }
            },

            keep() {
                if (this.state.animating) return;
                const cardEl = document.getElementById('card-wrapper').firstElementChild;
                const currentCard = this.state.currentDeck[this.state.drawIndex];
                
                if (cardEl) {
                    cardEl.classList.add('card-keep-right');
                    this.state.animating = true;
                    
                    if (!this.state.keptCards.find(c => c.id === currentCard.id)) {
                        this.state.keptCards.push(currentCard);
                        this.saveState(); 
                    }

                    setTimeout(() => {
                        this.advanceDeck();
                    }, 300);
                }
            },

            burn() {
                if (this.state.animating) return;
                const cardEl = document.getElementById('card-wrapper').firstElementChild;
                const currentCard = this.state.currentDeck[this.state.drawIndex];

                if (cardEl) {
                    cardEl.classList.add('card-burn');
                    this.state.animating = true;
                    
                    if (!this.state.burnedCardIds.includes(currentCard.id)) {
                        this.state.burnedCardIds.push(currentCard.id);
                        this.saveState();
                    }

                    setTimeout(() => {
                        this.advanceDeck();
                    }, 400); // slightly longer for burn anim
                }
            },
            
            reshuffle(manual = false) {
                if(this.state.animating) return;
                
                const cardEl = document.getElementById('card-wrapper').firstElementChild;
                if(cardEl) {
                    // If manually triggered, animate the current card out first?
                    // Or just swap instantly with a shuffle animation?
                    // Let's fade out current card then shuffle in.
                    cardEl.style.transition = 'all 0.2s ease-in';
                    cardEl.style.opacity = '0';
                    cardEl.style.transform = 'scale(0.9)';
                }

                this.state.animating = true;
                setTimeout(() => {
                    this.shuffleDecks();
                    this.state.animating = false;
                    this.render(true); // true = force shuffle enter animation
                }, 250);
            },

            restoreBurned(id) {
                this.state.burnedCardIds = this.state.burnedCardIds.filter(bid => bid !== id);
                this.saveState();
                
                // If we restore, we don't necessarily need to add it to current deck immediately,
                // it will appear next shuffle. Or we can insert it?
                // For simplicity, it appears next shuffle.
                this.render();
            },

            advanceDeck() {
                // If we are at the last card
                if (this.state.drawIndex >= this.state.currentDeck.length - 1) {
                    // Auto Reshuffle logic
                    this.shuffleDecks();
                    this.state.animating = false;
                    this.render(true); // Pass true to trigger reshuffle animation
                } else {
                    this.state.drawIndex++;
                    this.saveState();
                    this.state.animating = false;
                    this.render();
                }
            },

            clearSaved() {
                this.state.keptCards = [];
                this.saveState(); 
                this.render();
            },

            removeSaved(cardId) {
                this.state.keptCards = this.state.keptCards.filter(c => c.id !== cardId);
                this.saveState();
                this.render();
            },

            // --- HTML Generators ---

            getSuitTheme(c) {
                if (c.deck === 1) {
                    if(c.suit === 'hearts') return "Experience";
                    if(c.suit === 'spades') return "Mechanics";
                    if(c.suit === 'diamonds') return "Dynamics";
                    if(c.suit === 'clubs') return "Innovation";
                }
                if (c.deck === 2) {
                    if(c.suit === 'hearts') return "Narrative";
                    if(c.suit === 'spades') return "Hardcore";
                    if(c.suit === 'diamonds') return "Loops";
                    if(c.suit === 'clubs') return "Tech";
                }
                if (c.deck === 3) {
                    if(c.suit === 'hearts') return "Visual Style";
                    if(c.suit === 'spades') return "Audio";
                    if(c.suit === 'diamonds') return "Camera/View";
                    if(c.suit === 'clubs') return "Vibe";
                }
                if (c.deck === 4) {
                    if(c.suit === 'hearts') return "Biome";
                    if(c.suit === 'spades') return "Era/Tech";
                    if(c.suit === 'diamonds') return "Faction";
                    if(c.suit === 'clubs') return "Plot Hook";
                }
                if(c.suit === 'joker') return "Wildcard";
                return "";
            },

            getDeckName(id) {
                if(id === 1) return "Creative Deck";
                if(id === 2) return "Mech Deck";
                if(id === 3) return "Aesthetic Deck";
                if(id === 4) return "World Deck";
                return "Unknown";
            },

            renderCardHTML(card, animationClass = '') {
                const isRed = ['hearts', 'diamonds', 'joker'].includes(card.suit);
                const textColor = isRed ? 'text-red-600' : 'text-slate-800';
                const borderColor = isRed ? 'border-red-200' : 'border-slate-200';
                const bgGradient = isRed ? 'from-red-50 to-white' : 'from-slate-50 to-white';
                
                let suitIcon = '';
                if(card.suit === 'hearts') suitIcon = 'heart';
                else if(card.suit === 'diamonds') suitIcon = 'diamond';
                else if(card.suit === 'clubs') suitIcon = 'club';
                else if(card.suit === 'spades') suitIcon = 'spade';
                else suitIcon = 'sparkles'; 

                const suitTheme = this.getSuitTheme(card);
                const deckName = this.getDeckName(card.deck);

                return `
                <div class="w-full h-full rounded-2xl shadow-2xl border-4 ${borderColor} bg-gradient-to-br ${bgGradient} flex flex-col p-4 relative overflow-hidden select-none bg-white ${animationClass}">
                    <!-- Deck Badge -->
                    <div class="absolute top-0 left-0 right-0 flex justify-center pt-2">
                        <span class="text-[9px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full bg-black/5 text-black/40">
                            ${deckName}
                        </span>
                    </div>

                    <!-- Top Rank -->
                    <div class="absolute top-4 left-4 flex flex-col items-center leading-none ${textColor}">
                        <span class="text-3xl font-bold font-serif">${card.rank}</span>
                        <i data-lucide="${suitIcon}" class="w-4 h-4 fill-current"></i>
                    </div>

                    <!-- Bottom Rank -->
                    <div class="absolute bottom-4 right-4 flex flex-col items-center leading-none ${textColor} transform rotate-180">
                        <span class="text-3xl font-bold font-serif">${card.rank}</span>
                        <i data-lucide="${suitIcon}" class="w-4 h-4 fill-current"></i>
                    </div>

                    <!-- Content -->
                    <div class="flex-1 flex flex-col items-center justify-center text-center mt-6 z-10">
                        <div class="text-6xl mb-2 drop-shadow-sm filter">${card.visual}</div>
                        <div class="text-[10px] uppercase font-bold tracking-widest opacity-60 mb-1 ${textColor}">${suitTheme}</div>
                        <h2 class="text-xl font-bold uppercase tracking-tight mb-1 ${textColor}">${card.title}</h2>
                        <div class="w-12 h-0.5 bg-black/10 mb-3"></div>
                        <p class="text-sm font-medium text-slate-600 mb-2 px-2 italic leading-relaxed">"${card.concept}"</p>
                        
                        <div class="mt-auto mb-16 bg-white/60 backdrop-blur-sm rounded-lg p-2 text-xs text-slate-500 border border-black/5 w-full">
                            <span class="font-bold block mb-0.5 text-slate-400 uppercase text-[9px]">Examples</span>
                            <span class="text-slate-700 font-medium">${card.example}</span>
                        </div>
                    </div>
                </div>`;
            },

            // --- Render Logic ---
            render(isReshuffle = false) {
                const content = document.getElementById('main-content');
                const sidebarContent = document.getElementById('sidebar-content');
                const menuIcon = document.getElementById('menu-icon');

                // Toggle Mobile Menu Visibility
                if (this.state.mobileMenuOpen) {
                    sidebarContent.classList.remove('hidden');
                    menuIcon.setAttribute('data-lucide', 'x');
                } else {
                    sidebarContent.classList.add('hidden');
                    menuIcon.setAttribute('data-lucide', 'menu');
                }
                
                // Indicators
                document.querySelectorAll('.indicator').forEach(el => el.classList.add('hidden'));
                document.querySelectorAll('nav button').forEach(el => el.classList.remove('bg-indigo-600', 'text-white'));
                document.querySelectorAll('nav button i').forEach(el => el.classList.remove('text-indigo-400'));
                
                // Active Nav
                const activeNav = document.getElementById(`nav-${this.state.view}`);
                if(activeNav) {
                    activeNav.classList.add('bg-indigo-600', 'text-white');
                    activeNav.classList.remove('hover:bg-slate-800');
                }

                // Deck Buttons
                [1, 2, 3, 4].forEach(id => {
                    const btn = document.getElementById(`btn-deck-${id}`);
                    if(this.state.activeDecks[id]) {
                        btn.querySelector('.indicator').classList.remove('hidden');
                        btn.classList.add('bg-slate-800', 'border-indigo-500/50', 'text-indigo-300');
                    } else {
                        btn.classList.remove('bg-slate-800', 'border-indigo-500/50', 'text-indigo-300');
                    }
                });

                // Saved Count
                document.getElementById('saved-count').innerText = this.state.keptCards.length;

                // Views
                if (this.state.view === 'draw') {
                    const tpl = document.getElementById('tpl-draw');
                    if(content.innerHTML === '') content.innerHTML = tpl.innerHTML;
                    
                    // Only full re-render if we moved away or init, otherwise update in place is smoother usually, 
                    // but for simplicity we replace innerHTML for view switching.
                    // To support in-place updates during animation, we check if wrapper exists.
                    if (!document.getElementById('card-wrapper')) {
                        content.innerHTML = tpl.innerHTML;
                    }
                    
                    const activeCount = Object.values(this.state.activeDecks).filter(Boolean).length;
                    const deckLabel = activeCount > 1 ? `Combined Deck (${activeCount})` : 'Single Deck';
                    
                    document.getElementById('deck-label').innerText = deckLabel;
                    document.getElementById('card-counter').innerText = `Card ${this.state.drawIndex + 1} of ${this.state.currentDeck.length}`;

                    const wrapper = document.getElementById('card-wrapper');
                    const currentCard = this.state.currentDeck[this.state.drawIndex];
                    
                    // If isReshuffle, we use the reshuffle entrance animation
                    const animClass = isReshuffle ? 'card-reshuffle-enter' : 'card-enter';
                    
                    // Always re-render card content
                    wrapper.innerHTML = this.renderCardHTML(currentCard, animClass); 
                    
                    this.setupGestures();

                } else if (this.state.view === 'saved') {
                    const tpl = document.getElementById('tpl-saved');
                    content.innerHTML = tpl.innerHTML;
                    
                    const grid = document.getElementById('saved-grid');
                    if (this.state.keptCards.length === 0) {
                        document.getElementById('empty-state').classList.remove('hidden');
                        grid.classList.add('hidden');
                    } else {
                        grid.innerHTML = this.state.keptCards.map(card => `
                            <div class="bg-white rounded-xl p-4 shadow-sm border border-slate-200 flex items-start space-x-4 relative overflow-hidden">
                                <div class="absolute top-0 left-0 bg-slate-100 text-[8px] px-2 font-bold uppercase text-slate-400">${this.getDeckName(card.deck)}</div>
                                <div class="text-4xl bg-slate-50 p-2 rounded-lg border border-slate-100 mt-2">${card.visual}</div>
                                <div class="mt-2">
                                    <h3 class="font-bold text-slate-800">${card.title}</h3>
                                    <p class="text-xs text-slate-500 uppercase tracking-wide mb-1">${card.concept}</p>
                                    <p class="text-sm text-slate-600 leading-snug">"${card.example}"</p>
                                    <button onclick="app.removeSaved('${card.id}')" class="text-xs text-red-400 hover:text-red-600 mt-2 flex items-center">
                                        Remove
                                    </button>
                                </div>
                            </div>
                        `).join('');
                    }

                } else if (this.state.view === 'gallery') {
                    const tpl = document.getElementById('tpl-gallery');
                    content.innerHTML = tpl.innerHTML;
                    const galleryContent = document.getElementById('gallery-content');
                    
                    const suits = ['hearts', 'spades', 'diamonds', 'clubs', 'joker'];
                    const suitLabels = { hearts: 'Hearts', spades: 'Spades', diamonds: 'Diamonds', clubs: 'Clubs', joker: 'Jokers' };
                    
                    let html = '';
                    suits.forEach(suit => {
                        // Gather ALL cards from active decks to show in gallery
                        let allActiveCards = [];
                        if (this.state.activeDecks[1]) allActiveCards = [...allActiveCards, ...DECK_1];
                        if (this.state.activeDecks[2]) allActiveCards = [...allActiveCards, ...DECK_2];
                        if (this.state.activeDecks[3]) allActiveCards = [...allActiveCards, ...DECK_3];
                        if (this.state.activeDecks[4]) allActiveCards = [...allActiveCards, ...DECK_4];

                        const cards = allActiveCards.filter(c => c.suit === suit)
                            .sort((a,b) => {
                                const order = ['2','3','4','5','6','7','8','9','10','J','Q','K','A','â˜…'];
                                return order.indexOf(a.rank) - order.indexOf(b.rank);
                            });
                        
                        if(cards.length === 0) return;

                        const isRed = ['hearts', 'diamonds', 'joker'].includes(suit);
                        const colorClass = isRed ? 'text-red-600' : 'text-slate-700';
                        const iconColor = isRed ? 'text-red-500' : 'text-slate-700';
                        let suitIcon = '';
                        if(suit === 'hearts') suitIcon = 'heart';
                        else if(suit === 'diamonds') suitIcon = 'diamond';
                        else if(suit === 'clubs') suitIcon = 'club';
                        else if(suit === 'spades') suitIcon = 'spade';
                        else suitIcon = 'sparkles';

                        html += `
                        <div class="mb-10">
                            <div class="flex items-center space-x-2 border-b ${isRed ? 'border-red-200' : 'border-slate-200'} pb-2 mb-4">
                                <i data-lucide="${suitIcon}" class="${iconColor} w-4 h-4 fill-current"></i>
                                <h3 class="text-lg font-bold uppercase tracking-wider ${colorClass}">${suitLabels[suit]}</h3>
                                <span class="text-xs text-slate-400 ml-auto font-mono bg-slate-100 px-2 py-0.5 rounded-full">${cards.length} Cards</span>
                            </div>
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                                ${cards.map(c => {
                                    const isBurned = this.state.burnedCardIds.includes(c.id);
                                    const opacityClass = isBurned ? 'opacity-50 grayscale hover:grayscale-0 hover:opacity-100' : '';
                                    const burnedOverlay = isBurned ? `
                                        <div class="absolute inset-0 bg-slate-900/10 flex items-center justify-center z-20 pointer-events-none group-hover:hidden">
                                            <div class="bg-black/70 text-white text-[10px] uppercase font-bold px-2 py-1 rounded-full">Burned</div>
                                        </div>
                                    ` : '';

                                    return `
                                    <div onclick="${isBurned ? `app.restoreBurned('${c.id}')` : ''}" class="cursor-pointer ${opacityClass} bg-white rounded-lg p-3 shadow-sm border border-slate-200 hover:border-indigo-300 transition-all flex flex-col items-center text-center relative overflow-hidden group">
                                        ${burnedOverlay}
                                        <div class="absolute top-1 right-2 text-[8px] font-bold uppercase text-slate-300">${c.deck === 1 ? 'CREATIVE' : c.deck === 2 ? 'MECH' : c.deck === 3 ? 'ART' : 'WORLD'}</div>
                                        <div class="text-2xl mb-1 z-10">${c.visual}</div>
                                        <div class="text-xs font-bold uppercase z-10 ${colorClass}">${c.rank}</div>
                                        <div class="font-bold text-slate-800 text-sm leading-tight mt-1 z-10">${c.title}</div>
                                        <div class="text-[10px] text-slate-500 mt-1 z-10 opacity-80 line-clamp-2">${c.concept}</div>
                                        <div class="absolute top-0 right-0 p-1 opacity-10 group-hover:opacity-20 ${iconColor}">
                                            <i data-lucide="${suitIcon}" class="w-10 h-10 fill-current"></i>
                                        </div>
                                    </div>
                                `}).join('')}
                            </div>
                        </div>`;
                    });
                    
                    galleryContent.innerHTML = html;
                }

                lucide.createIcons();
            },

            // --- Gestures ---
            setupGestures() {
                const wrapper = document.getElementById('card-wrapper');
                if(!wrapper) return;

                wrapper.addEventListener('touchstart', (e) => {
                    this.touchEnd = null;
                    this.touchStart = { x: e.targetTouches[0].clientX, y: e.targetTouches[0].clientY };
                });

                wrapper.addEventListener('touchmove', (e) => {
                    this.touchEnd = { x: e.targetTouches[0].clientX, y: e.targetTouches[0].clientY };
                });

                wrapper.addEventListener('touchend', () => {
                    if (!this.touchStart || !this.touchEnd) return;
                    const distanceX = this.touchStart.x - this.touchEnd.x;
                    const distanceY = this.touchStart.y - this.touchEnd.y;
                    const isHorizontal = Math.abs(distanceX) > Math.abs(distanceY);
                    const minSwipe = 50;

                    if (isHorizontal) {
                        if (distanceX > minSwipe) this.discard(); // Swipe Left
                        else if (distanceX < -minSwipe) this.keep(); // Swipe Right
                    } else {
                        if (distanceY < -minSwipe) this.reshuffle(true); // Pull Down
                    }
                });
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            app.init();
        });

    </script>
</body>
</html>
